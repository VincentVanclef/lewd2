{"id":"JXT/","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"./database","loc":{"line":3,"column":42},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\passport.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=u(require(\"passport\")),r=require(\"passport-local\"),a=u(require(\"./database\")),t=u(require(\"bcrypt\")),s=u(require(\"crypto\"));function u(e){return e&&e.__esModule?e:{default:e}}const n=e=>s.default.createHash(\"sha1\").update(e.toString()+Date.now().toString()).digest(\"hex\");e.default.use(new r.Strategy({usernameField:\"username\",passwordField:\"password\"},async(e,r,s)=>{const u=await a.default.connect(),i=(await u.query('SELECT id, password \\n                                       FROM \"Users\" \\n                                       WHERE username = $1;',[e])).rows[0];if(void 0===i)return s(null,!1);t.default.compare(r,i.password).then(async e=>{if(1==e){const e=parseInt(i.id),r=n(e);return await u.query('INSERT INTO \"LoginTokens\" (token, registered, userid)\\n                                        VALUES ($1, NOW(), $2);',[r,e]),await u.release(),s(null,r)}return await u.release(),s(null,!1)})})),e.default.serializeUser((e,r)=>r(null,e)),e.default.deserializeUser((e,r)=>r(null,e));var i=e.default;exports.default=i;","map":{"mappings":[{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":0}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":13}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":20}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":35}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":43}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":56}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":57}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":64}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":68}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":76}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":89}},{"source":"helpers/passport.js","original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"helpers/passport.js","original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"helpers/passport.js","original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"helpers/passport.js","original":{"line":1,"column":0},"generated":{"line":1,"column":99}},{"source":"helpers/passport.js","original":{"line":1,"column":0},"generated":{"line":1,"column":107}},{"source":"helpers/passport.js","original":{"line":2,"column":0},"generated":{"line":1,"column":120}},{"source":"helpers/passport.js","original":{"line":2,"column":0},"generated":{"line":1,"column":122}},{"source":"helpers/passport.js","original":{"line":2,"column":0},"generated":{"line":1,"column":130}},{"source":"helpers/passport.js","original":{"line":3,"column":0},"generated":{"line":1,"column":148}},{"source":"helpers/passport.js","original":{"line":3,"column":0},"generated":{"line":1,"column":150}},{"source":"helpers/passport.js","original":{"line":3,"column":0},"generated":{"line":1,"column":152}},{"source":"helpers/passport.js","original":{"line":3,"column":0},"generated":{"line":1,"column":160}},{"source":"helpers/passport.js","original":{"line":4,"column":0},"generated":{"line":1,"column":175}},{"source":"helpers/passport.js","original":{"line":4,"column":0},"generated":{"line":1,"column":177}},{"source":"helpers/passport.js","original":{"line":4,"column":0},"generated":{"line":1,"column":179}},{"source":"helpers/passport.js","original":{"line":4,"column":0},"generated":{"line":1,"column":187}},{"source":"helpers/passport.js","original":{"line":5,"column":0},"generated":{"line":1,"column":198}},{"source":"helpers/passport.js","original":{"line":5,"column":0},"generated":{"line":1,"column":200}},{"source":"helpers/passport.js","original":{"line":5,"column":0},"generated":{"line":1,"column":202}},{"source":"helpers/passport.js","original":{"line":5,"column":0},"generated":{"line":1,"column":210}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":221}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":230}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":232}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":235}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":242}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":245}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":247}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":258}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":260}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":261}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":269}},{"source":"helpers/passport.js","original":{"line":7,"column":0},"generated":{"line":1,"column":272}},{"source":"helpers/passport.js","name":"generateLoginToken","original":{"line":7,"column":6},"generated":{"line":1,"column":278}},{"source":"helpers/passport.js","name":"userid","original":{"line":7,"column":27},"generated":{"line":1,"column":280}},{"source":"helpers/passport.js","name":"crypto","original":{"line":7,"column":37},"generated":{"line":1,"column":283}},{"source":"helpers/passport.js","name":"createHash","original":{"line":7,"column":44},"generated":{"line":1,"column":285}},{"source":"helpers/passport.js","name":"createHash","original":{"line":7,"column":44},"generated":{"line":1,"column":293}},{"source":"helpers/passport.js","original":{"line":7,"column":55},"generated":{"line":1,"column":304}},{"source":"helpers/passport.js","name":"update","original":{"line":8,"column":44},"generated":{"line":1,"column":312}},{"source":"helpers/passport.js","name":"userid","original":{"line":8,"column":51},"generated":{"line":1,"column":319}},{"source":"helpers/passport.js","name":"toString","original":{"line":8,"column":58},"generated":{"line":1,"column":321}},{"source":"helpers/passport.js","name":"Date","original":{"line":8,"column":71},"generated":{"line":1,"column":332}},{"source":"helpers/passport.js","name":"now","original":{"line":8,"column":76},"generated":{"line":1,"column":337}},{"source":"helpers/passport.js","name":"toString","original":{"line":8,"column":82},"generated":{"line":1,"column":343}},{"source":"helpers/passport.js","name":"digest","original":{"line":9,"column":44},"generated":{"line":1,"column":355}},{"source":"helpers/passport.js","original":{"line":9,"column":51},"generated":{"line":1,"column":362}},{"source":"helpers/passport.js","name":"passport","original":{"line":11,"column":0},"generated":{"line":1,"column":369}},{"source":"helpers/passport.js","name":"use","original":{"line":11,"column":9},"generated":{"line":1,"column":371}},{"source":"helpers/passport.js","name":"use","original":{"line":11,"column":9},"generated":{"line":1,"column":379}},{"source":"helpers/passport.js","original":{"line":11,"column":13},"generated":{"line":1,"column":383}},{"source":"helpers/passport.js","name":"LocalStrategy","original":{"line":11,"column":17},"generated":{"line":1,"column":387}},{"source":"helpers/passport.js","original":{"line":11,"column":13},"generated":{"line":1,"column":389}},{"source":"helpers/passport.js","original":{"line":11,"column":31},"generated":{"line":1,"column":398}},{"source":"helpers/passport.js","name":"usernameField","original":{"line":12,"column":4},"generated":{"line":1,"column":399}},{"source":"helpers/passport.js","original":{"line":12,"column":19},"generated":{"line":1,"column":413}},{"source":"helpers/passport.js","name":"passwordField","original":{"line":13,"column":4},"generated":{"line":1,"column":424}},{"source":"helpers/passport.js","original":{"line":13,"column":19},"generated":{"line":1,"column":438}},{"source":"helpers/passport.js","original":{"line":14,"column":3},"generated":{"line":1,"column":450}},{"source":"helpers/passport.js","name":"username","original":{"line":14,"column":10},"generated":{"line":1,"column":456}},{"source":"helpers/passport.js","name":"password","original":{"line":14,"column":20},"generated":{"line":1,"column":458}},{"source":"helpers/passport.js","name":"next","original":{"line":14,"column":30},"generated":{"line":1,"column":460}},{"source":"helpers/passport.js","name":"client","original":{"line":15,"column":10},"generated":{"line":1,"column":465}},{"source":"helpers/passport.js","name":"client","original":{"line":15,"column":10},"generated":{"line":1,"column":471}},{"source":"helpers/passport.js","name":"db","original":{"line":15,"column":25},"generated":{"line":1,"column":479}},{"source":"helpers/passport.js","name":"connect","original":{"line":15,"column":28},"generated":{"line":1,"column":481}},{"source":"helpers/passport.js","name":"connect","original":{"line":15,"column":28},"generated":{"line":1,"column":489}},{"source":"helpers/passport.js","name":"user","original":{"line":19,"column":10},"generated":{"line":1,"column":499}},{"source":"helpers/passport.js","name":"client","original":{"line":16,"column":25},"generated":{"line":1,"column":508}},{"source":"helpers/passport.js","name":"query","original":{"line":16,"column":32},"generated":{"line":1,"column":510}},{"source":"helpers/passport.js","original":{"line":16,"column":39},"generated":{"line":1,"column":516}},{"source":"helpers/passport.js","original":{"line":18,"column":62},"generated":{"line":1,"column":654}},{"source":"helpers/passport.js","name":"username","original":{"line":18,"column":63},"generated":{"line":1,"column":655}},{"source":"helpers/passport.js","name":"rows","original":{"line":19,"column":21},"generated":{"line":1,"column":660}},{"source":"helpers/passport.js","original":{"line":19,"column":26},"generated":{"line":1,"column":665}},{"source":"helpers/passport.js","name":"user","original":{"line":21,"column":8},"generated":{"line":1,"column":668}},{"source":"helpers/passport.js","name":"undefined","original":{"line":21,"column":17},"generated":{"line":1,"column":676}},{"source":"helpers/passport.js","name":"user","original":{"line":21,"column":8},"generated":{"line":1,"column":680}},{"source":"helpers/passport.js","original":{"line":22,"column":8},"generated":{"line":1,"column":682}},{"source":"helpers/passport.js","name":"next","original":{"line":22,"column":15},"generated":{"line":1,"column":689}},{"source":"helpers/passport.js","original":{"line":22,"column":20},"generated":{"line":1,"column":691}},{"source":"helpers/passport.js","original":{"line":22,"column":26},"generated":{"line":1,"column":697}},{"source":"helpers/passport.js","name":"compare","original":{"line":24,"column":11},"generated":{"line":1,"column":700}},{"source":"helpers/passport.js","name":"compare","original":{"line":24,"column":11},"generated":{"line":1,"column":702}},{"source":"helpers/passport.js","name":"compare","original":{"line":24,"column":11},"generated":{"line":1,"column":710}},{"source":"helpers/passport.js","name":"password","original":{"line":24,"column":19},"generated":{"line":1,"column":718}},{"source":"helpers/passport.js","name":"user","original":{"line":24,"column":29},"generated":{"line":1,"column":720}},{"source":"helpers/passport.js","name":"password","original":{"line":24,"column":34},"generated":{"line":1,"column":722}},{"source":"helpers/passport.js","name":"then","original":{"line":25,"column":11},"generated":{"line":1,"column":732}},{"source":"helpers/passport.js","original":{"line":25,"column":16},"generated":{"line":1,"column":737}},{"source":"helpers/passport.js","original":{"line":25,"column":16},"generated":{"line":1,"column":743}},{"source":"helpers/passport.js","name":"result","original":{"line":26,"column":18},"generated":{"line":1,"column":747}},{"source":"helpers/passport.js","original":{"line":26,"column":28},"generated":{"line":1,"column":750}},{"source":"helpers/passport.js","name":"result","original":{"line":26,"column":18},"generated":{"line":1,"column":753}},{"source":"helpers/passport.js","original":{"line":26,"column":33},"generated":{"line":1,"column":755}},{"source":"helpers/passport.js","name":"userId","original":{"line":27,"column":26},"generated":{"line":1,"column":756}},{"source":"helpers/passport.js","name":"userId","original":{"line":27,"column":26},"generated":{"line":1,"column":762}},{"source":"helpers/passport.js","name":"parseInt","original":{"line":27,"column":38},"generated":{"line":1,"column":764}},{"source":"helpers/passport.js","name":"user","original":{"line":27,"column":47},"generated":{"line":1,"column":773}},{"source":"helpers/passport.js","name":"id","original":{"line":27,"column":52},"generated":{"line":1,"column":775}},{"source":"helpers/passport.js","name":"userToken","original":{"line":28,"column":26},"generated":{"line":1,"column":779}},{"source":"helpers/passport.js","name":"generateLoginToken","original":{"line":28,"column":38},"generated":{"line":1,"column":781}},{"source":"helpers/passport.js","name":"userId","original":{"line":28,"column":57},"generated":{"line":1,"column":783}},{"source":"helpers/passport.js","name":"next","original":{"line":35,"column":27},"generated":{"line":1,"column":786}},{"source":"helpers/passport.js","name":"client","original":{"line":29,"column":26},"generated":{"line":1,"column":799}},{"source":"helpers/passport.js","name":"query","original":{"line":29,"column":33},"generated":{"line":1,"column":801}},{"source":"helpers/passport.js","original":{"line":29,"column":40},"generated":{"line":1,"column":807}},{"source":"helpers/passport.js","original":{"line":30,"column":66},"generated":{"line":1,"column":928}},{"source":"helpers/passport.js","name":"userToken","original":{"line":31,"column":44},"generated":{"line":1,"column":929}},{"source":"helpers/passport.js","name":"userId","original":{"line":32,"column":44},"generated":{"line":1,"column":931}},{"source":"helpers/passport.js","name":"client","original":{"line":34,"column":26},"generated":{"line":1,"column":941}},{"source":"helpers/passport.js","name":"release","original":{"line":34,"column":33},"generated":{"line":1,"column":943}},{"source":"helpers/passport.js","name":"next","original":{"line":35,"column":27},"generated":{"line":1,"column":953}},{"source":"helpers/passport.js","original":{"line":35,"column":32},"generated":{"line":1,"column":955}},{"source":"helpers/passport.js","name":"userToken","original":{"line":35,"column":38},"generated":{"line":1,"column":960}},{"source":"helpers/passport.js","name":"next","original":{"line":38,"column":27},"generated":{"line":1,"column":963}},{"source":"helpers/passport.js","name":"client","original":{"line":37,"column":26},"generated":{"line":1,"column":976}},{"source":"helpers/passport.js","name":"release","original":{"line":37,"column":33},"generated":{"line":1,"column":978}},{"source":"helpers/passport.js","name":"next","original":{"line":38,"column":27},"generated":{"line":1,"column":988}},{"source":"helpers/passport.js","original":{"line":38,"column":32},"generated":{"line":1,"column":990}},{"source":"helpers/passport.js","original":{"line":38,"column":38},"generated":{"line":1,"column":996}},{"source":"helpers/passport.js","name":"passport","original":{"line":43,"column":0},"generated":{"line":1,"column":1004}},{"source":"helpers/passport.js","name":"serializeUser","original":{"line":43,"column":9},"generated":{"line":1,"column":1006}},{"source":"helpers/passport.js","name":"serializeUser","original":{"line":43,"column":9},"generated":{"line":1,"column":1014}},{"source":"helpers/passport.js","original":{"line":43,"column":25},"generated":{"line":1,"column":1028}},{"source":"helpers/passport.js","name":"user","original":{"line":43,"column":26},"generated":{"line":1,"column":1029}},{"source":"helpers/passport.js","name":"next","original":{"line":43,"column":32},"generated":{"line":1,"column":1031}},{"source":"helpers/passport.js","name":"next","original":{"line":43,"column":41},"generated":{"line":1,"column":1035}},{"source":"helpers/passport.js","original":{"line":43,"column":46},"generated":{"line":1,"column":1037}},{"source":"helpers/passport.js","name":"user","original":{"line":43,"column":52},"generated":{"line":1,"column":1042}},{"source":"helpers/passport.js","name":"passport","original":{"line":44,"column":0},"generated":{"line":1,"column":1046}},{"source":"helpers/passport.js","name":"deserializeUser","original":{"line":44,"column":9},"generated":{"line":1,"column":1048}},{"source":"helpers/passport.js","name":"deserializeUser","original":{"line":44,"column":9},"generated":{"line":1,"column":1056}},{"source":"helpers/passport.js","original":{"line":44,"column":25},"generated":{"line":1,"column":1072}},{"source":"helpers/passport.js","name":"user","original":{"line":44,"column":26},"generated":{"line":1,"column":1073}},{"source":"helpers/passport.js","name":"next","original":{"line":44,"column":32},"generated":{"line":1,"column":1075}},{"source":"helpers/passport.js","name":"next","original":{"line":44,"column":41},"generated":{"line":1,"column":1079}},{"source":"helpers/passport.js","original":{"line":44,"column":46},"generated":{"line":1,"column":1081}},{"source":"helpers/passport.js","name":"user","original":{"line":44,"column":52},"generated":{"line":1,"column":1086}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":1090}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":1094}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":1096}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":1098}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":1106}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":1114}},{"source":"helpers/passport.js","name":"passport","original":{"line":47,"column":15},"generated":{"line":1,"column":1122}}],"sources":{"helpers/passport.js":"import passport                      from \"passport\";\r\nimport { Strategy as LocalStrategy } from 'passport-local';\r\nimport db                            from \"./database\";\r\nimport bcrypt                        from \"bcrypt\";\r\nimport crypto                        from \"crypto\";\r\n\r\nconst generateLoginToken = userid => crypto.createHash(\"sha1\")\r\n                                           .update(userid.toString() + Date.now().toString())\r\n                                           .digest(\"hex\");\r\n\r\npassport.use(new LocalStrategy({\r\n    usernameField: \"username\",\r\n    passwordField: \"password\"\r\n}, async (username, password, next) => {\r\n    const client = await db.connect();\r\n    const res    = await client.query(`SELECT id, password \r\n                                       FROM \"Users\" \r\n                                       WHERE username = $1;`, [username]);\r\n    const user = res.rows[0];\r\n\r\n    if (user === undefined)\r\n        return next(null, false);\r\n\r\n    bcrypt.compare(password, user.password)\r\n          .then(async result => {\r\n              if (result == true){\r\n                    const userId    = parseInt(user.id);\r\n                    const userToken = generateLoginToken(userId);\r\n                    await client.query(`INSERT INTO \"LoginTokens\" (token, registered, userid)\r\n                                        VALUES ($1, NOW(), $2);`, [\r\n                                            userToken,\r\n                                            userId\r\n                                        ]);\r\n                    await client.release(); \r\n                    return next(null, userToken);\r\n              } else {\r\n                    await client.release();\r\n                    return next(null, false);\r\n              }\r\n          });\r\n}));\r\n\r\npassport.serializeUser(  (user, next) => next(null, user));\r\npassport.deserializeUser((user, next) => next(null, user));\r\n\r\n\r\nexport default passport;\r\n"},"lineCount":null}},"hash":"40e52823bd71f2471d82aab3f65b313d","cacheData":{"env":{}}}