{"id":"NshV","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":1,"column":19},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Controllers\\user\\changePassword.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.post=o,exports.validate=void 0;var s=a(require(\"../../helpers/database\")),e=a(require(\"bcrypt\")),r=require(\"express-validator/check\");function a(s){return s&&s.__esModule?s:{default:s}}const t=(s,{req:e})=>{if(e.body[\"new-password\"]!==e.body[\"password-check\"])throw new Error(\"Passwords does not match\");return!0};async function o(a,t){const o=(0,r.validationResult)(a);if(!o.isEmpty())return a.session.err=o.array(),t.redirect(\"/user\");const d=await s.default.connect(),i=(await d.query('SELECT password \\n                                                FROM \"Users\" \\n                                                WHERE id = $1;',[t.locals.user.id])).rows[0].password;if(!(await e.default.compare(a.body[\"old-password\"],i)))return a.flash(\"incorrectOldPassword\",\"Your old password is incorrect\"),t.redirect(\"/user\");const c=await e.default.hash(a.body[\"new-password\"],parseInt(process.env.BCRYT_SALT_ROUNDS));await d.query('UPDATE \"Users\" SET password = $1 WHERE id = $2;',[c,t.locals.user.id]),await d.release(),a.flash(\"passwordChanged\",\"Your password has now been updated\"),t.redirect(\"/user\")}const d=[(0,r.check)(\"old-password\").exists().withMessage(\"Your old password is incorrect\").isLength({min:3,max:72}).withMessage(\"Must be more than 3 characters long\"),(0,r.check)(\"new-password\").exists().withMessage(\"Please supply a password\").isLength({min:3,max:72}).withMessage(\"Password needs to be 2 characters long\").custom(t).withMessage(\"The provided passwords must be the same\"),(0,r.check)(\"password-check\").exists().withMessage(\"Password checker is incorrect\").isLength({min:3,max:72}).withMessage(\"Must be more than 3 characters long\")];exports.validate=d;","map":{"mappings":[{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":0}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":13}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":20}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":35}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":43}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":56}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":57}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":64}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":68}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":76}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":81}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":83}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":91}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":105}},{"source":"Controllers/user/changePassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":107}},{"source":"Controllers/user/changePassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":111}},{"source":"Controllers/user/changePassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":113}},{"source":"Controllers/user/changePassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":115}},{"source":"Controllers/user/changePassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":123}},{"source":"Controllers/user/changePassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":150}},{"source":"Controllers/user/changePassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":152}},{"source":"Controllers/user/changePassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":154}},{"source":"Controllers/user/changePassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":162}},{"source":"Controllers/user/changePassword.js","original":{"line":3,"column":0},"generated":{"line":1,"column":173}},{"source":"Controllers/user/changePassword.js","original":{"line":3,"column":0},"generated":{"line":1,"column":175}},{"source":"Controllers/user/changePassword.js","original":{"line":3,"column":0},"generated":{"line":1,"column":183}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":210}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":219}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":221}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":224}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":231}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":234}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":236}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":247}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":249}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":250}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":258}},{"source":"Controllers/user/changePassword.js","original":{"line":6,"column":0},"generated":{"line":1,"column":261}},{"source":"Controllers/user/changePassword.js","name":"isPasswordsIdentical","original":{"line":6,"column":6},"generated":{"line":1,"column":267}},{"source":"Controllers/user/changePassword.js","original":{"line":6,"column":29},"generated":{"line":1,"column":269}},{"source":"Controllers/user/changePassword.js","name":"value","original":{"line":6,"column":30},"generated":{"line":1,"column":270}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":6,"column":39},"generated":{"line":1,"column":273}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":6,"column":39},"generated":{"line":1,"column":277}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":7,"column":8},"generated":{"line":1,"column":283}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":7,"column":8},"generated":{"line":1,"column":286}},{"source":"Controllers/user/changePassword.js","name":"body","original":{"line":7,"column":12},"generated":{"line":1,"column":288}},{"source":"Controllers/user/changePassword.js","original":{"line":7,"column":17},"generated":{"line":1,"column":293}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":7,"column":37},"generated":{"line":1,"column":311}},{"source":"Controllers/user/changePassword.js","name":"body","original":{"line":7,"column":41},"generated":{"line":1,"column":313}},{"source":"Controllers/user/changePassword.js","original":{"line":7,"column":46},"generated":{"line":1,"column":318}},{"source":"Controllers/user/changePassword.js","original":{"line":8,"column":14},"generated":{"line":1,"column":336}},{"source":"Controllers/user/changePassword.js","original":{"line":8,"column":14},"generated":{"line":1,"column":342}},{"source":"Controllers/user/changePassword.js","name":"Error","original":{"line":8,"column":18},"generated":{"line":1,"column":346}},{"source":"Controllers/user/changePassword.js","original":{"line":8,"column":24},"generated":{"line":1,"column":352}},{"source":"Controllers/user/changePassword.js","original":{"line":10,"column":15},"generated":{"line":1,"column":380}},{"source":"Controllers/user/changePassword.js","original":{"line":10,"column":15},"generated":{"line":1,"column":387}},{"source":"Controllers/user/changePassword.js","original":{"line":14,"column":0},"generated":{"line":1,"column":390}},{"source":"Controllers/user/changePassword.js","name":"post","original":{"line":14,"column":15},"generated":{"line":1,"column":405}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":14,"column":20},"generated":{"line":1,"column":407}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":14,"column":25},"generated":{"line":1,"column":409}},{"source":"Controllers/user/changePassword.js","name":"errors","original":{"line":15,"column":10},"generated":{"line":1,"column":412}},{"source":"Controllers/user/changePassword.js","name":"errors","original":{"line":15,"column":10},"generated":{"line":1,"column":418}},{"source":"Controllers/user/changePassword.js","original":{"line":15,"column":19},"generated":{"line":1,"column":421}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":15,"column":36},"generated":{"line":1,"column":423}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":15,"column":36},"generated":{"line":1,"column":425}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":15,"column":36},"generated":{"line":1,"column":443}},{"source":"Controllers/user/changePassword.js","original":{"line":17,"column":8},"generated":{"line":1,"column":446}},{"source":"Controllers/user/changePassword.js","name":"errors","original":{"line":17,"column":9},"generated":{"line":1,"column":450}},{"source":"Controllers/user/changePassword.js","name":"isEmpty","original":{"line":17,"column":16},"generated":{"line":1,"column":452}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":19,"column":15},"generated":{"line":1,"column":462}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":18,"column":8},"generated":{"line":1,"column":469}},{"source":"Controllers/user/changePassword.js","name":"session","original":{"line":18,"column":12},"generated":{"line":1,"column":471}},{"source":"Controllers/user/changePassword.js","name":"err","original":{"line":18,"column":20},"generated":{"line":1,"column":479}},{"source":"Controllers/user/changePassword.js","name":"errors","original":{"line":18,"column":26},"generated":{"line":1,"column":483}},{"source":"Controllers/user/changePassword.js","name":"array","original":{"line":18,"column":33},"generated":{"line":1,"column":485}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":19,"column":15},"generated":{"line":1,"column":493}},{"source":"Controllers/user/changePassword.js","name":"redirect","original":{"line":19,"column":19},"generated":{"line":1,"column":495}},{"source":"Controllers/user/changePassword.js","original":{"line":19,"column":28},"generated":{"line":1,"column":504}},{"source":"Controllers/user/changePassword.js","name":"client","original":{"line":23,"column":10},"generated":{"line":1,"column":513}},{"source":"Controllers/user/changePassword.js","name":"client","original":{"line":23,"column":10},"generated":{"line":1,"column":519}},{"source":"Controllers/user/changePassword.js","name":"db","original":{"line":23,"column":34},"generated":{"line":1,"column":527}},{"source":"Controllers/user/changePassword.js","name":"connect","original":{"line":23,"column":37},"generated":{"line":1,"column":529}},{"source":"Controllers/user/changePassword.js","name":"connect","original":{"line":23,"column":37},"generated":{"line":1,"column":537}},{"source":"Controllers/user/changePassword.js","name":"currentPassword","original":{"line":28,"column":10},"generated":{"line":1,"column":547}},{"source":"Controllers/user/changePassword.js","name":"client","original":{"line":24,"column":34},"generated":{"line":1,"column":556}},{"source":"Controllers/user/changePassword.js","name":"query","original":{"line":24,"column":41},"generated":{"line":1,"column":558}},{"source":"Controllers/user/changePassword.js","original":{"line":24,"column":48},"generated":{"line":1,"column":564}},{"source":"Controllers/user/changePassword.js","original":{"line":26,"column":65},"generated":{"line":1,"column":710}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":26,"column":66},"generated":{"line":1,"column":711}},{"source":"Controllers/user/changePassword.js","name":"locals","original":{"line":26,"column":70},"generated":{"line":1,"column":713}},{"source":"Controllers/user/changePassword.js","name":"user","original":{"line":26,"column":77},"generated":{"line":1,"column":720}},{"source":"Controllers/user/changePassword.js","name":"id","original":{"line":26,"column":82},"generated":{"line":1,"column":725}},{"source":"Controllers/user/changePassword.js","name":"rows","original":{"line":28,"column":40},"generated":{"line":1,"column":731}},{"source":"Controllers/user/changePassword.js","original":{"line":28,"column":45},"generated":{"line":1,"column":736}},{"source":"Controllers/user/changePassword.js","name":"password","original":{"line":28,"column":48},"generated":{"line":1,"column":739}},{"source":"Controllers/user/changePassword.js","original":{"line":33,"column":8},"generated":{"line":1,"column":748}},{"source":"Controllers/user/changePassword.js","name":"bcrypt","original":{"line":31,"column":32},"generated":{"line":1,"column":759}},{"source":"Controllers/user/changePassword.js","name":"compare","original":{"line":31,"column":39},"generated":{"line":1,"column":761}},{"source":"Controllers/user/changePassword.js","name":"compare","original":{"line":31,"column":39},"generated":{"line":1,"column":769}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":31,"column":47},"generated":{"line":1,"column":777}},{"source":"Controllers/user/changePassword.js","name":"body","original":{"line":31,"column":51},"generated":{"line":1,"column":779}},{"source":"Controllers/user/changePassword.js","original":{"line":31,"column":56},"generated":{"line":1,"column":784}},{"source":"Controllers/user/changePassword.js","name":"currentPassword","original":{"line":31,"column":73},"generated":{"line":1,"column":800}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":35,"column":15},"generated":{"line":1,"column":804}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":34,"column":8},"generated":{"line":1,"column":811}},{"source":"Controllers/user/changePassword.js","name":"flash","original":{"line":34,"column":12},"generated":{"line":1,"column":813}},{"source":"Controllers/user/changePassword.js","original":{"line":34,"column":18},"generated":{"line":1,"column":819}},{"source":"Controllers/user/changePassword.js","original":{"line":34,"column":42},"generated":{"line":1,"column":842}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":35,"column":15},"generated":{"line":1,"column":876}},{"source":"Controllers/user/changePassword.js","name":"redirect","original":{"line":35,"column":19},"generated":{"line":1,"column":878}},{"source":"Controllers/user/changePassword.js","original":{"line":35,"column":28},"generated":{"line":1,"column":887}},{"source":"Controllers/user/changePassword.js","name":"newPassword","original":{"line":39,"column":10},"generated":{"line":1,"column":896}},{"source":"Controllers/user/changePassword.js","name":"newPassword","original":{"line":39,"column":10},"generated":{"line":1,"column":902}},{"source":"Controllers/user/changePassword.js","name":"bcrypt","original":{"line":39,"column":30},"generated":{"line":1,"column":910}},{"source":"Controllers/user/changePassword.js","name":"hash","original":{"line":39,"column":37},"generated":{"line":1,"column":912}},{"source":"Controllers/user/changePassword.js","name":"hash","original":{"line":39,"column":37},"generated":{"line":1,"column":920}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":39,"column":42},"generated":{"line":1,"column":925}},{"source":"Controllers/user/changePassword.js","name":"body","original":{"line":39,"column":46},"generated":{"line":1,"column":927}},{"source":"Controllers/user/changePassword.js","original":{"line":39,"column":51},"generated":{"line":1,"column":932}},{"source":"Controllers/user/changePassword.js","name":"parseInt","original":{"line":39,"column":68},"generated":{"line":1,"column":948}},{"source":"Controllers/user/changePassword.js","name":"process","original":{"line":39,"column":77},"generated":{"line":1,"column":957}},{"source":"Controllers/user/changePassword.js","name":"env","original":{"line":39,"column":85},"generated":{"line":1,"column":965}},{"source":"Controllers/user/changePassword.js","name":"BCRYT_SALT_ROUNDS","original":{"line":39,"column":89},"generated":{"line":1,"column":969}},{"source":"Controllers/user/changePassword.js","name":"client","original":{"line":41,"column":10},"generated":{"line":1,"column":995}},{"source":"Controllers/user/changePassword.js","name":"query","original":{"line":41,"column":17},"generated":{"line":1,"column":997}},{"source":"Controllers/user/changePassword.js","original":{"line":41,"column":24},"generated":{"line":1,"column":1003}},{"source":"Controllers/user/changePassword.js","original":{"line":41,"column":74},"generated":{"line":1,"column":1053}},{"source":"Controllers/user/changePassword.js","name":"newPassword","original":{"line":41,"column":75},"generated":{"line":1,"column":1054}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":41,"column":88},"generated":{"line":1,"column":1056}},{"source":"Controllers/user/changePassword.js","name":"locals","original":{"line":41,"column":92},"generated":{"line":1,"column":1058}},{"source":"Controllers/user/changePassword.js","name":"user","original":{"line":41,"column":99},"generated":{"line":1,"column":1065}},{"source":"Controllers/user/changePassword.js","name":"id","original":{"line":41,"column":104},"generated":{"line":1,"column":1070}},{"source":"Controllers/user/changePassword.js","name":"client","original":{"line":42,"column":10},"generated":{"line":1,"column":1081}},{"source":"Controllers/user/changePassword.js","name":"release","original":{"line":42,"column":17},"generated":{"line":1,"column":1083}},{"source":"Controllers/user/changePassword.js","name":"req","original":{"line":45,"column":4},"generated":{"line":1,"column":1093}},{"source":"Controllers/user/changePassword.js","name":"flash","original":{"line":45,"column":8},"generated":{"line":1,"column":1095}},{"source":"Controllers/user/changePassword.js","original":{"line":45,"column":14},"generated":{"line":1,"column":1101}},{"source":"Controllers/user/changePassword.js","original":{"line":45,"column":33},"generated":{"line":1,"column":1119}},{"source":"Controllers/user/changePassword.js","name":"res","original":{"line":46,"column":4},"generated":{"line":1,"column":1157}},{"source":"Controllers/user/changePassword.js","name":"redirect","original":{"line":46,"column":8},"generated":{"line":1,"column":1159}},{"source":"Controllers/user/changePassword.js","original":{"line":46,"column":17},"generated":{"line":1,"column":1168}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":1177}},{"source":"Controllers/user/changePassword.js","name":"validate","original":{"line":49,"column":6},"generated":{"line":1,"column":1183}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":17},"generated":{"line":1,"column":1185}},{"source":"Controllers/user/changePassword.js","original":{"line":50,"column":4},"generated":{"line":1,"column":1187}},{"source":"Controllers/user/changePassword.js","original":{"line":50,"column":10},"generated":{"line":1,"column":1189}},{"source":"Controllers/user/changePassword.js","original":{"line":50,"column":10},"generated":{"line":1,"column":1191}},{"source":"Controllers/user/changePassword.js","original":{"line":50,"column":10},"generated":{"line":1,"column":1198}},{"source":"Controllers/user/changePassword.js","name":"exists","original":{"line":50,"column":26},"generated":{"line":1,"column":1214}},{"source":"Controllers/user/changePassword.js","name":"withMessage","original":{"line":50,"column":54},"generated":{"line":1,"column":1223}},{"source":"Controllers/user/changePassword.js","original":{"line":50,"column":66},"generated":{"line":1,"column":1235}},{"source":"Controllers/user/changePassword.js","name":"isLength","original":{"line":51,"column":26},"generated":{"line":1,"column":1269}},{"source":"Controllers/user/changePassword.js","original":{"line":51,"column":35},"generated":{"line":1,"column":1278}},{"source":"Controllers/user/changePassword.js","name":"min","original":{"line":51,"column":36},"generated":{"line":1,"column":1279}},{"source":"Controllers/user/changePassword.js","original":{"line":51,"column":41},"generated":{"line":1,"column":1283}},{"source":"Controllers/user/changePassword.js","name":"max","original":{"line":51,"column":44},"generated":{"line":1,"column":1285}},{"source":"Controllers/user/changePassword.js","original":{"line":51,"column":49},"generated":{"line":1,"column":1289}},{"source":"Controllers/user/changePassword.js","name":"withMessage","original":{"line":51,"column":54},"generated":{"line":1,"column":1294}},{"source":"Controllers/user/changePassword.js","original":{"line":51,"column":66},"generated":{"line":1,"column":1306}},{"source":"Controllers/user/changePassword.js","original":{"line":53,"column":4},"generated":{"line":1,"column":1346}},{"source":"Controllers/user/changePassword.js","original":{"line":53,"column":10},"generated":{"line":1,"column":1348}},{"source":"Controllers/user/changePassword.js","original":{"line":53,"column":10},"generated":{"line":1,"column":1350}},{"source":"Controllers/user/changePassword.js","original":{"line":53,"column":10},"generated":{"line":1,"column":1357}},{"source":"Controllers/user/changePassword.js","name":"exists","original":{"line":53,"column":26},"generated":{"line":1,"column":1373}},{"source":"Controllers/user/changePassword.js","name":"withMessage","original":{"line":53,"column":55},"generated":{"line":1,"column":1382}},{"source":"Controllers/user/changePassword.js","original":{"line":53,"column":67},"generated":{"line":1,"column":1394}},{"source":"Controllers/user/changePassword.js","name":"isLength","original":{"line":54,"column":26},"generated":{"line":1,"column":1422}},{"source":"Controllers/user/changePassword.js","original":{"line":54,"column":35},"generated":{"line":1,"column":1431}},{"source":"Controllers/user/changePassword.js","name":"min","original":{"line":54,"column":36},"generated":{"line":1,"column":1432}},{"source":"Controllers/user/changePassword.js","original":{"line":54,"column":41},"generated":{"line":1,"column":1436}},{"source":"Controllers/user/changePassword.js","name":"max","original":{"line":54,"column":44},"generated":{"line":1,"column":1438}},{"source":"Controllers/user/changePassword.js","original":{"line":54,"column":49},"generated":{"line":1,"column":1442}},{"source":"Controllers/user/changePassword.js","name":"withMessage","original":{"line":54,"column":55},"generated":{"line":1,"column":1447}},{"source":"Controllers/user/changePassword.js","original":{"line":54,"column":67},"generated":{"line":1,"column":1459}},{"source":"Controllers/user/changePassword.js","name":"custom","original":{"line":55,"column":26},"generated":{"line":1,"column":1501}},{"source":"Controllers/user/changePassword.js","name":"isPasswordsIdentical","original":{"line":55,"column":33},"generated":{"line":1,"column":1508}},{"source":"Controllers/user/changePassword.js","name":"withMessage","original":{"line":55,"column":55},"generated":{"line":1,"column":1511}},{"source":"Controllers/user/changePassword.js","original":{"line":55,"column":67},"generated":{"line":1,"column":1523}},{"source":"Controllers/user/changePassword.js","original":{"line":57,"column":4},"generated":{"line":1,"column":1567}},{"source":"Controllers/user/changePassword.js","original":{"line":57,"column":10},"generated":{"line":1,"column":1569}},{"source":"Controllers/user/changePassword.js","original":{"line":57,"column":10},"generated":{"line":1,"column":1571}},{"source":"Controllers/user/changePassword.js","original":{"line":57,"column":10},"generated":{"line":1,"column":1578}},{"source":"Controllers/user/changePassword.js","name":"exists","original":{"line":57,"column":28},"generated":{"line":1,"column":1596}},{"source":"Controllers/user/changePassword.js","name":"withMessage","original":{"line":57,"column":56},"generated":{"line":1,"column":1605}},{"source":"Controllers/user/changePassword.js","original":{"line":57,"column":68},"generated":{"line":1,"column":1617}},{"source":"Controllers/user/changePassword.js","name":"isLength","original":{"line":58,"column":28},"generated":{"line":1,"column":1650}},{"source":"Controllers/user/changePassword.js","original":{"line":58,"column":37},"generated":{"line":1,"column":1659}},{"source":"Controllers/user/changePassword.js","name":"min","original":{"line":58,"column":38},"generated":{"line":1,"column":1660}},{"source":"Controllers/user/changePassword.js","original":{"line":58,"column":43},"generated":{"line":1,"column":1664}},{"source":"Controllers/user/changePassword.js","name":"max","original":{"line":58,"column":46},"generated":{"line":1,"column":1666}},{"source":"Controllers/user/changePassword.js","original":{"line":58,"column":51},"generated":{"line":1,"column":1670}},{"source":"Controllers/user/changePassword.js","name":"withMessage","original":{"line":58,"column":56},"generated":{"line":1,"column":1675}},{"source":"Controllers/user/changePassword.js","original":{"line":58,"column":68},"generated":{"line":1,"column":1687}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":1727}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":1735}},{"source":"Controllers/user/changePassword.js","original":{"line":49,"column":0},"generated":{"line":1,"column":1744}}],"sources":{"Controllers/user/changePassword.js":"import db     from \"../../helpers/database\";\r\nimport bcrypt from \"bcrypt\";\r\nimport { check, validationResult } from 'express-validator/check';\r\n\r\n// Are the password and password checker identical?\r\nconst isPasswordsIdentical = (value, { req }) => {\r\n    if (req.body[\"new-password\"] !== req.body[\"password-check\"]) {\r\n        throw new Error(\"Passwords does not match\");\r\n    } else {\r\n        return true;\r\n    }\r\n}\r\n\r\nasync function post(req, res) {\r\n    const errors = validationResult(req);\r\n\r\n    if (!errors.isEmpty()) {\r\n        req.session.err = errors.array();\r\n        return res.redirect(\"/user\");\r\n    }\r\n\r\n    // Get password\r\n    const client          = await db.connect();\r\n    const getPassword     = await client.query(`SELECT password \r\n                                                FROM \"Users\" \r\n                                                WHERE id = $1;`, [res.locals.user.id]);\r\n\r\n    const currentPassword = getPassword.rows[0].password;\r\n\r\n    // Check password\r\n    const passwordCheck = await bcrypt.compare(req.body[\"old-password\"], currentPassword)\r\n    \r\n    if (!passwordCheck) {\r\n        req.flash(\"incorrectOldPassword\", \"Your old password is incorrect\");\r\n        return res.redirect(\"/user\");\r\n    }\r\n    \r\n    // Change password\r\n    const newPassword = await bcrypt.hash(req.body[\"new-password\"], parseInt(process.env.BCRYT_SALT_ROUNDS));\r\n\r\n    await client.query(`UPDATE \"Users\" SET password = $1 WHERE id = $2;`, [newPassword, res.locals.user.id]);\r\n    await client.release();\r\n    \r\n    // Return\r\n    req.flash(\"passwordChanged\", \"Your password has now been updated\");\r\n    res.redirect(\"/user\");\r\n}\r\n\r\nconst validate = [\r\n    check(\"old-password\").exists()                   .withMessage(\"Your old password is incorrect\")\r\n                         .isLength({min: 3, max: 72}).withMessage(\"Must be more than 3 characters long\"),\r\n\r\n    check(\"new-password\").exists()                    .withMessage(\"Please supply a password\")\r\n                         .isLength({min: 3, max: 72}) .withMessage(\"Password needs to be 2 characters long\")\r\n                         .custom(isPasswordsIdentical).withMessage(\"The provided passwords must be the same\"),\r\n    \r\n    check(\"password-check\").exists()                   .withMessage(\"Password checker is incorrect\")\r\n                           .isLength({min: 3, max: 72}).withMessage(\"Must be more than 3 characters long\"),\r\n\r\n]\r\n\r\nexport { post, validate }"},"lineCount":null}},"hash":"054ee00c1595db33777cc4e2dedd5d55","cacheData":{"env":{}}}