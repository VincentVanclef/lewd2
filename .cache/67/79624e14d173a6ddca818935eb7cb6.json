{"id":"g2j8","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":1,"column":15},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Admin\\deleteUser.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"../FileDeletion/deleteFiles","loc":{"line":2,"column":24},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Admin\\deleteUser.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\FileDeletion\\deleteFiles.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=t(require(\"../../helpers/database\")),a=t(require(\"../FileDeletion/deleteFiles\"));function t(e){return e&&e.__esModule?e:{default:e}}const n=async(t,n=!1)=>{const i=await e.default.connect();if(await i.query('DELETE FROM \"Users\" WHERE id = $1;',[t]),await i.query('DELETE FROM \"LoginTokens\" WHERE userid = $1;',[t]),n){const e=await i.query('SELECT \\n                                                DISTINCT ON (filename) \\n                                                filename\\n                                            FROM \\n                                                \"Uploads\" \\n                                            WHERE \\n                                                userid = $1 \\n                                            AND \\n                                                filename NOT IN (SELECT filename FROM \"Uploads\" WHERE userid != $1);',[t]);if(0!=e.rows.length){const t=e.rows.map(e=>e.filename);await(0,a.default)(t)}}await i.release()};var i=n;exports.default=i;","map":{"mappings":[{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":0}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":13}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":20}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":35}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":43}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":56}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":57}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":64}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":68}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":76}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":89}},{"source":"Functions/Admin/deleteUser.js","original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"Functions/Admin/deleteUser.js","original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"Functions/Admin/deleteUser.js","original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"Functions/Admin/deleteUser.js","original":{"line":1,"column":0},"generated":{"line":1,"column":99}},{"source":"Functions/Admin/deleteUser.js","original":{"line":1,"column":0},"generated":{"line":1,"column":107}},{"source":"Functions/Admin/deleteUser.js","original":{"line":2,"column":0},"generated":{"line":1,"column":134}},{"source":"Functions/Admin/deleteUser.js","original":{"line":2,"column":0},"generated":{"line":1,"column":136}},{"source":"Functions/Admin/deleteUser.js","original":{"line":2,"column":0},"generated":{"line":1,"column":138}},{"source":"Functions/Admin/deleteUser.js","original":{"line":2,"column":0},"generated":{"line":1,"column":146}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":178}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":187}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":189}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":192}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":199}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":202}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":204}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":215}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":217}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":218}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":226}},{"source":"Functions/Admin/deleteUser.js","original":{"line":9,"column":0},"generated":{"line":1,"column":229}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":9,"column":6},"generated":{"line":1,"column":235}},{"source":"Functions/Admin/deleteUser.js","original":{"line":9,"column":19},"generated":{"line":1,"column":237}},{"source":"Functions/Admin/deleteUser.js","name":"id","original":{"line":9,"column":26},"generated":{"line":1,"column":243}},{"source":"Functions/Admin/deleteUser.js","name":"deleteFiles","original":{"line":9,"column":30},"generated":{"line":1,"column":245}},{"source":"Functions/Admin/deleteUser.js","original":{"line":9,"column":44},"generated":{"line":1,"column":248}},{"source":"Functions/Admin/deleteUser.js","name":"client","original":{"line":10,"column":10},"generated":{"line":1,"column":253}},{"source":"Functions/Admin/deleteUser.js","name":"client","original":{"line":10,"column":10},"generated":{"line":1,"column":259}},{"source":"Functions/Admin/deleteUser.js","name":"db","original":{"line":10,"column":25},"generated":{"line":1,"column":267}},{"source":"Functions/Admin/deleteUser.js","name":"connect","original":{"line":10,"column":28},"generated":{"line":1,"column":269}},{"source":"Functions/Admin/deleteUser.js","name":"connect","original":{"line":10,"column":28},"generated":{"line":1,"column":277}},{"source":"Functions/Admin/deleteUser.js","name":"deleteFiles","original":{"line":14,"column":8},"generated":{"line":1,"column":287}},{"source":"Functions/Admin/deleteUser.js","name":"client","original":{"line":11,"column":25},"generated":{"line":1,"column":296}},{"source":"Functions/Admin/deleteUser.js","name":"query","original":{"line":11,"column":32},"generated":{"line":1,"column":298}},{"source":"Functions/Admin/deleteUser.js","original":{"line":11,"column":39},"generated":{"line":1,"column":304}},{"source":"Functions/Admin/deleteUser.js","original":{"line":11,"column":76},"generated":{"line":1,"column":341}},{"source":"Functions/Admin/deleteUser.js","name":"id","original":{"line":11,"column":77},"generated":{"line":1,"column":342}},{"source":"Functions/Admin/deleteUser.js","name":"client","original":{"line":12,"column":25},"generated":{"line":1,"column":352}},{"source":"Functions/Admin/deleteUser.js","name":"query","original":{"line":12,"column":32},"generated":{"line":1,"column":354}},{"source":"Functions/Admin/deleteUser.js","original":{"line":12,"column":39},"generated":{"line":1,"column":360}},{"source":"Functions/Admin/deleteUser.js","original":{"line":12,"column":86},"generated":{"line":1,"column":407}},{"source":"Functions/Admin/deleteUser.js","name":"id","original":{"line":12,"column":87},"generated":{"line":1,"column":408}},{"source":"Functions/Admin/deleteUser.js","name":"deleteFiles","original":{"line":14,"column":8},"generated":{"line":1,"column":412}},{"source":"Functions/Admin/deleteUser.js","original":{"line":14,"column":21},"generated":{"line":1,"column":414}},{"source":"Functions/Admin/deleteUser.js","name":"getFiles","original":{"line":15,"column":14},"generated":{"line":1,"column":415}},{"source":"Functions/Admin/deleteUser.js","name":"getFiles","original":{"line":15,"column":14},"generated":{"line":1,"column":421}},{"source":"Functions/Admin/deleteUser.js","name":"client","original":{"line":15,"column":31},"generated":{"line":1,"column":429}},{"source":"Functions/Admin/deleteUser.js","name":"query","original":{"line":15,"column":38},"generated":{"line":1,"column":431}},{"source":"Functions/Admin/deleteUser.js","original":{"line":15,"column":45},"generated":{"line":1,"column":437}},{"source":"Functions/Admin/deleteUser.js","original":{"line":23,"column":119},"generated":{"line":1,"column":971}},{"source":"Functions/Admin/deleteUser.js","name":"id","original":{"line":24,"column":52},"generated":{"line":1,"column":972}},{"source":"Functions/Admin/deleteUser.js","name":"getFiles","original":{"line":26,"column":12},"generated":{"line":1,"column":976}},{"source":"Functions/Admin/deleteUser.js","original":{"line":26,"column":36},"generated":{"line":1,"column":979}},{"source":"Functions/Admin/deleteUser.js","name":"getFiles","original":{"line":26,"column":12},"generated":{"line":1,"column":982}},{"source":"Functions/Admin/deleteUser.js","name":"rows","original":{"line":26,"column":21},"generated":{"line":1,"column":984}},{"source":"Functions/Admin/deleteUser.js","name":"length","original":{"line":26,"column":26},"generated":{"line":1,"column":989}},{"source":"Functions/Admin/deleteUser.js","original":{"line":26,"column":39},"generated":{"line":1,"column":996}},{"source":"Functions/Admin/deleteUser.js","name":"files","original":{"line":30,"column":18},"generated":{"line":1,"column":997}},{"source":"Functions/Admin/deleteUser.js","name":"files","original":{"line":30,"column":18},"generated":{"line":1,"column":1003}},{"source":"Functions/Admin/deleteUser.js","name":"getFiles","original":{"line":30,"column":26},"generated":{"line":1,"column":1005}},{"source":"Functions/Admin/deleteUser.js","name":"rows","original":{"line":30,"column":35},"generated":{"line":1,"column":1007}},{"source":"Functions/Admin/deleteUser.js","name":"map","original":{"line":31,"column":35},"generated":{"line":1,"column":1012}},{"source":"Functions/Admin/deleteUser.js","name":"f","original":{"line":31,"column":39},"generated":{"line":1,"column":1016}},{"source":"Functions/Admin/deleteUser.js","name":"f","original":{"line":31,"column":44},"generated":{"line":1,"column":1019}},{"source":"Functions/Admin/deleteUser.js","name":"filename","original":{"line":31,"column":46},"generated":{"line":1,"column":1021}},{"source":"Functions/Admin/deleteUser.js","original":{"line":32,"column":18},"generated":{"line":1,"column":1037}},{"source":"Functions/Admin/deleteUser.js","name":"files","original":{"line":32,"column":30},"generated":{"line":1,"column":1039}},{"source":"Functions/Admin/deleteUser.js","name":"files","original":{"line":32,"column":30},"generated":{"line":1,"column":1041}},{"source":"Functions/Admin/deleteUser.js","name":"files","original":{"line":32,"column":30},"generated":{"line":1,"column":1050}},{"source":"Functions/Admin/deleteUser.js","name":"client","original":{"line":36,"column":10},"generated":{"line":1,"column":1060}},{"source":"Functions/Admin/deleteUser.js","name":"release","original":{"line":36,"column":17},"generated":{"line":1,"column":1062}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":1073}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":1077}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":1079}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":1081}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":1089}},{"source":"Functions/Admin/deleteUser.js","name":"deleteUser","original":{"line":40,"column":15},"generated":{"line":1,"column":1097}}],"sources":{"Functions/Admin/deleteUser.js":"import db from \"../../helpers/database\";\r\nimport removeFiles from \"../FileDeletion/deleteFiles\";\r\n\r\n/**\r\n * Purges user and the users login tokens\r\n * @param {Number} id - User's ID\r\n * @param {Boolean} deleteFiles - If the users files needs to be deleted as well\r\n */\r\nconst deleteUser = async (id, deleteFiles = false) => {\r\n    const client = await db.connect();\r\n                   await client.query(`DELETE FROM \"Users\" WHERE id = $1;`, [id]);\r\n                   await client.query(`DELETE FROM \"LoginTokens\" WHERE userid = $1;`, [id])\r\n\r\n    if (deleteFiles) {\r\n        const getFiles = await client.query(`SELECT \r\n                                                DISTINCT ON (filename) \r\n                                                filename\r\n                                            FROM \r\n                                                \"Uploads\" \r\n                                            WHERE \r\n                                                userid = $1 \r\n                                            AND \r\n                                                filename NOT IN (SELECT filename FROM \"Uploads\" WHERE userid != $1);`, [\r\n                                                    id\r\n                                                ]);\r\n        if (getFiles.rows.length != 0) {\r\n            // Transform rows from [ { filename: '80931ac767d1_176.20.222.243.zip' }, { filename: '80931ac767d1_176.20.222.243.zip' } ]\r\n            // To [ '80931ac767d1_176.20.222.243.zip', '80931ac767d1_176.20.222.243.zip' ]\r\n\r\n            const files = getFiles.rows\r\n                                  .map(f => f.filename);\r\n            await removeFiles(files);\r\n        }\r\n    }\r\n    \r\n    await client.release();\r\n} \r\n\r\n\r\nexport default deleteUser;"},"lineCount":null}},"hash":"a07f79db57ef3bb21100bf63418fcb6f","cacheData":{"env":{}}}