{"id":"Functions/Upload/addImageToDatabase.js","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":2,"column":24},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\addImageToDatabase.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"./deletionKey","loc":{"line":3,"column":24},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\addImageToDatabase.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\deletionKey.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsStringEscape = _interopRequireDefault(require(\"js-string-escape\"));\n\nvar _database = _interopRequireDefault(require(\"../../helpers/database\"));\n\nvar _deletionKey = _interopRequireDefault(require(\"./deletionKey\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * \r\n * @param {object} file \r\n * @param {number} userid \r\n */\nconst addImageToDatabase = async (file, userid) => {\n  const client = await _database.default.connect();\n  let deltionKeyCheck = true; // Check for unique deletion key\n\n  do {\n    file.deletionKey = (0, _deletionKey.default)(10);\n    const fileDeletionKeyCheck = await client.query(`SELECT id FROM \"Uploads\" WHERE deletionkey = $1;`, [file.deletionKey]);\n    deltionKeyCheck = fileDeletionKeyCheck.rows[0] != undefined; // The deletionkey beeds to be unique\n    // IE if the above query is not undefined then it needs to generate a new token\n  } while (deltionKeyCheck);\n\n  const insertUpload = await client.query(`INSERT INTO \"Uploads\" (filename, originalName, filesha, userid, duplicate, uploaddate, deletionkey, size) \n                                             VALUES ($1, $2, $3, $4, $5, NOW(), $6, $7);`, [file.filename, file.originalname, file.hash, userid, file.duplicate.toString(), file.deletionKey, file.size]);\n  await client.release();\n};\n\nvar _default = addImageToDatabase;\nexports.default = _default;","map":{"mappings":[{"generated":{"line":8,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":1,"column":0}},{"generated":{"line":10,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":2,"column":0}},{"generated":{"line":12,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":3,"column":0}},{"generated":{"line":16,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":5,"column":0}},{"generated":{"line":21,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":0}},{"name":"addImageToDatabase","generated":{"line":21,"column":6},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":6}},{"generated":{"line":21,"column":24},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":24}},{"generated":{"line":21,"column":27},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":27}},{"name":"file","generated":{"line":21,"column":34},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":34}},{"generated":{"line":21,"column":38},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":27}},{"name":"userid","generated":{"line":21,"column":40},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":40}},{"generated":{"line":21,"column":46},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":27}},{"generated":{"line":21,"column":51},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":51}},{"generated":{"line":22,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":4}},{"name":"client","generated":{"line":22,"column":8},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":10}},{"generated":{"line":22,"column":14},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":16}},{"generated":{"line":22,"column":17},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":25}},{"name":"db","generated":{"line":22,"column":23},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":31}},{"name":"connect","generated":{"line":22,"column":41},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":34}},{"generated":{"line":22,"column":48},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":31}},{"generated":{"line":22,"column":50},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":11,"column":4}},{"generated":{"line":23,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":13,"column":4}},{"name":"deltionKeyCheck","generated":{"line":23,"column":6},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":13,"column":8}},{"generated":{"line":23,"column":21},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":13,"column":23}},{"generated":{"line":23,"column":24},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":13,"column":26}},{"generated":{"line":23,"column":28},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":13,"column":4}},{"generated":{"line":23,"column":29},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":51}},{"generated":{"line":23,"column":30},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":15,"column":4}},{"generated":{"line":25,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":16,"column":4}},{"generated":{"line":25,"column":5},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":16,"column":7}},{"name":"file","generated":{"line":26,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":8}},{"name":"file","generated":{"line":26,"column":4},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":8}},{"generated":{"line":26,"column":8},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":12}},{"name":"deletionKey","generated":{"line":26,"column":9},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":13}},{"generated":{"line":26,"column":20},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":8}},{"generated":{"line":26,"column":23},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":27}},{"generated":{"line":26,"column":49},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":39}},{"generated":{"line":26,"column":51},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":27}},{"generated":{"line":26,"column":52},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":8}},{"generated":{"line":27,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":8}},{"name":"fileDeletionKeyCheck","generated":{"line":27,"column":10},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":14}},{"generated":{"line":27,"column":30},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":34}},{"generated":{"line":27,"column":33},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":37}},{"name":"client","generated":{"line":27,"column":39},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":43}},{"generated":{"line":27,"column":45},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":49}},{"name":"query","generated":{"line":27,"column":46},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":50}},{"generated":{"line":27,"column":51},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":43}},{"generated":{"line":27,"column":52},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":57}},{"generated":{"line":27,"column":102},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":43}},{"generated":{"line":27,"column":104},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":108}},{"name":"file","generated":{"line":27,"column":105},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":109}},{"generated":{"line":27,"column":109},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":113}},{"name":"deletionKey","generated":{"line":27,"column":110},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":114}},{"generated":{"line":27,"column":121},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":108}},{"generated":{"line":27,"column":122},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":43}},{"generated":{"line":27,"column":123},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":8}},{"name":"deltionKeyCheck","generated":{"line":28,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":8}},{"name":"deltionKeyCheck","generated":{"line":28,"column":4},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":8}},{"generated":{"line":28,"column":19},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":23}},{"name":"fileDeletionKeyCheck","generated":{"line":28,"column":22},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":27}},{"generated":{"line":28,"column":42},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":47}},{"name":"rows","generated":{"line":28,"column":43},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":48}},{"generated":{"line":28,"column":47},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":27}},{"generated":{"line":28,"column":48},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":53}},{"generated":{"line":28,"column":49},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":27}},{"name":"undefined","generated":{"line":28,"column":54},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":59}},{"generated":{"line":28,"column":63},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":8}},{"generated":{"line":28,"column":64},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":16,"column":7}},{"generated":{"line":28,"column":65},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":71}},{"generated":{"line":29,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":21,"column":70}},{"generated":{"line":30,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":22,"column":5}},{"generated":{"line":30,"column":3},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":16,"column":4}},{"name":"deltionKeyCheck","generated":{"line":30,"column":11},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":22,"column":13}},{"generated":{"line":30,"column":26},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":16,"column":4}},{"generated":{"line":32,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":4}},{"name":"insertUpload","generated":{"line":32,"column":8},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":10}},{"generated":{"line":32,"column":20},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":22}},{"generated":{"line":32,"column":23},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":25}},{"name":"client","generated":{"line":32,"column":29},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":31}},{"generated":{"line":32,"column":35},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":37}},{"name":"query","generated":{"line":32,"column":36},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":38}},{"generated":{"line":32,"column":41},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":31}},{"generated":{"line":32,"column":42},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":45}},{"generated":{"line":33,"column":89},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":31}},{"generated":{"line":33,"column":91},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"name":"file","generated":{"line":33,"column":92},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":26,"column":49}},{"generated":{"line":33,"column":96},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":26,"column":53}},{"name":"filename","generated":{"line":33,"column":97},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":26,"column":54}},{"generated":{"line":33,"column":105},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"name":"file","generated":{"line":33,"column":107},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":27,"column":49}},{"generated":{"line":33,"column":111},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":27,"column":53}},{"name":"originalname","generated":{"line":33,"column":112},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":27,"column":54}},{"generated":{"line":33,"column":124},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"name":"file","generated":{"line":33,"column":126},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":28,"column":49}},{"generated":{"line":33,"column":130},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":28,"column":53}},{"name":"hash","generated":{"line":33,"column":131},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":28,"column":54}},{"generated":{"line":33,"column":135},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"name":"userid","generated":{"line":33,"column":137},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":29,"column":49}},{"generated":{"line":33,"column":143},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"name":"file","generated":{"line":33,"column":145},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":30,"column":49}},{"generated":{"line":33,"column":149},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":30,"column":53}},{"name":"duplicate","generated":{"line":33,"column":150},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":30,"column":54}},{"generated":{"line":33,"column":159},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":30,"column":49}},{"name":"toString","generated":{"line":33,"column":160},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":30,"column":64}},{"generated":{"line":33,"column":168},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":30,"column":49}},{"generated":{"line":33,"column":170},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"name":"file","generated":{"line":33,"column":172},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":31,"column":49}},{"generated":{"line":33,"column":176},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":31,"column":53}},{"name":"deletionKey","generated":{"line":33,"column":177},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":31,"column":54}},{"generated":{"line":33,"column":188},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"name":"file","generated":{"line":33,"column":190},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":32,"column":49}},{"generated":{"line":33,"column":194},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":32,"column":53}},{"name":"size","generated":{"line":33,"column":195},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":32,"column":54}},{"generated":{"line":33,"column":199},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91}},{"generated":{"line":33,"column":200},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":31}},{"generated":{"line":33,"column":201},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":4}},{"generated":{"line":34,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":34,"column":25}},{"name":"client","generated":{"line":34,"column":8},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":34,"column":31}},{"generated":{"line":34,"column":14},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":34,"column":37}},{"name":"release","generated":{"line":34,"column":15},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":34,"column":38}},{"generated":{"line":34,"column":22},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":34,"column":31}},{"generated":{"line":34,"column":24},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":34,"column":25}},{"generated":{"line":35,"column":0},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":35,"column":1}},{"generated":{"line":35,"column":1},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":0}},{"name":"addImageToDatabase","generated":{"line":37,"column":15},"source":"Functions/Upload/addImageToDatabase.js","original":{"line":37,"column":15}}],"sources":{"Functions/Upload/addImageToDatabase.js":"import jsStringEscape      from \"js-string-escape\";\r\nimport db          from \"../../helpers/database\";\r\nimport deletionKey from \"./deletionKey\";\r\n\r\n/**\r\n * \r\n * @param {object} file \r\n * @param {number} userid \r\n */\r\nconst addImageToDatabase = async (file, userid) => {\r\n    const client       = await db.connect();\r\n\r\n    let deltionKeyCheck = true;\r\n\r\n    // Check for unique deletion key\r\n    do {\r\n        file.deletionKey = deletionKey(10);\r\n        \r\n        const fileDeletionKeyCheck = await client.query(`SELECT id FROM \"Uploads\" WHERE deletionkey = $1;`, [file.deletionKey]);\r\n        deltionKeyCheck = (fileDeletionKeyCheck.rows[0] != undefined); // The deletionkey beeds to be unique\r\n                                                                      // IE if the above query is not undefined then it needs to generate a new token\r\n    } while (deltionKeyCheck);\r\n\r\n    const insertUpload = await client.query(`INSERT INTO \"Uploads\" (filename, originalName, filesha, userid, duplicate, uploaddate, deletionkey, size) \r\n                                             VALUES ($1, $2, $3, $4, $5, NOW(), $6, $7);`, [\r\n                                                 file.filename,\r\n                                                 file.originalname, \r\n                                                 file.hash, \r\n                                                 userid, \r\n                                                 file.duplicate.toString(),\r\n                                                 file.deletionKey,\r\n                                                 file.size\r\n                                                ]);\r\n                         await client.release();\r\n};\r\n\r\nexport default addImageToDatabase;"},"lineCount":null}},"hash":"5ad5b709d81cd30376b9fa0e5259b3f5","cacheData":{"env":{}}}