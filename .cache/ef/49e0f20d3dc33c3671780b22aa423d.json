{"id":"7Htl","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":3,"column":40},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Controllers\\admin\\token.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"../../Functions/Token/formatUploadSize","loc":{"line":4,"column":40},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Controllers\\admin\\token.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Token\\formatUploadSize.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.get=n,exports.post=r,exports.validate=void 0;var e=a(require(\"crypto\")),t=require(\"express-validator/check\"),s=a(require(\"../../helpers/database\")),i=a(require(\"../../Functions/Token/formatUploadSize\"));function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){t.render(\"user\",{menuItem:\"token\"})}async function r(a,n){const r=(0,t.validationResult)(a);if(!r.isEmpty())return a.session.err=r.array(),n.redirect(\"/user/admin/token\");const o=(0,i.default)(a.body.size,a.body.unit),u=\"on\"===a.body.isadmin,d=e.default.createHash(\"sha1\").update(\"You can register now\"+Date.now().toString()).digest(\"hex\"),l=await s.default.connect();await l.query('INSERT INTO \"RegisterTokens\" (token, registered, used, uploadsize, isadmin)\\n                        VALUES ($1, NOW(), $2, $3, $4);',[d,!1,o,u]),await l.release(),n.render(\"user\",{menuItem:\"token\",registerUrl:process.env.SITE_LINK+\"register/\"+d})}const o=[(0,t.check)(\"size\").exists().withMessage(\"You need to set an upload size\").isNumeric().withMessage(\"Upload size must be a number\").isInt().withMessage(\"Upload size needs to be a number\").isLength({min:1,max:999999999999}).withMessage(\"Upload size can't be less than 1 byte or greater than 1TB (0.91TiB)\"),(0,t.check)(\"unit\").isLength({min:1,max:3}).withMessage(\"Upload unit needs to be a valid unit\").isIn([\"B\",\"kB\",\"MB\",\"GB\",\"KiB\",\"MiB\",\"GiB\"]).withMessage(\"Upload unit needs to be a valid unit\")];exports.validate=o;","map":{"mappings":[{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":0}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":13}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":20}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":35}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":43}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":56}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":57}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":64}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":68}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":76}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":80}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":82}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":90}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":95}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":97}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":105}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":119}},{"source":"Controllers/admin/token.js","original":{"line":1,"column":0},"generated":{"line":1,"column":121}},{"source":"Controllers/admin/token.js","original":{"line":1,"column":0},"generated":{"line":1,"column":125}},{"source":"Controllers/admin/token.js","original":{"line":1,"column":0},"generated":{"line":1,"column":127}},{"source":"Controllers/admin/token.js","original":{"line":1,"column":0},"generated":{"line":1,"column":129}},{"source":"Controllers/admin/token.js","original":{"line":1,"column":0},"generated":{"line":1,"column":137}},{"source":"Controllers/admin/token.js","original":{"line":2,"column":0},"generated":{"line":1,"column":148}},{"source":"Controllers/admin/token.js","original":{"line":2,"column":0},"generated":{"line":1,"column":150}},{"source":"Controllers/admin/token.js","original":{"line":2,"column":0},"generated":{"line":1,"column":158}},{"source":"Controllers/admin/token.js","original":{"line":3,"column":0},"generated":{"line":1,"column":185}},{"source":"Controllers/admin/token.js","original":{"line":3,"column":0},"generated":{"line":1,"column":187}},{"source":"Controllers/admin/token.js","original":{"line":3,"column":0},"generated":{"line":1,"column":189}},{"source":"Controllers/admin/token.js","original":{"line":3,"column":0},"generated":{"line":1,"column":197}},{"source":"Controllers/admin/token.js","original":{"line":4,"column":0},"generated":{"line":1,"column":224}},{"source":"Controllers/admin/token.js","original":{"line":4,"column":0},"generated":{"line":1,"column":226}},{"source":"Controllers/admin/token.js","original":{"line":4,"column":0},"generated":{"line":1,"column":228}},{"source":"Controllers/admin/token.js","original":{"line":4,"column":0},"generated":{"line":1,"column":236}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":279}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":288}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":290}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":293}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":300}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":303}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":305}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":316}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":318}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":319}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":327}},{"source":"Controllers/admin/token.js","original":{"line":6,"column":0},"generated":{"line":1,"column":330}},{"source":"Controllers/admin/token.js","name":"get","original":{"line":6,"column":9},"generated":{"line":1,"column":339}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":6,"column":13},"generated":{"line":1,"column":341}},{"source":"Controllers/admin/token.js","name":"res","original":{"line":6,"column":18},"generated":{"line":1,"column":343}},{"source":"Controllers/admin/token.js","name":"res","original":{"line":7,"column":4},"generated":{"line":1,"column":346}},{"source":"Controllers/admin/token.js","name":"render","original":{"line":7,"column":8},"generated":{"line":1,"column":348}},{"source":"Controllers/admin/token.js","original":{"line":7,"column":15},"generated":{"line":1,"column":355}},{"source":"Controllers/admin/token.js","original":{"line":7,"column":23},"generated":{"line":1,"column":362}},{"source":"Controllers/admin/token.js","name":"menuItem","original":{"line":8,"column":8},"generated":{"line":1,"column":363}},{"source":"Controllers/admin/token.js","original":{"line":8,"column":18},"generated":{"line":1,"column":372}},{"source":"Controllers/admin/token.js","original":{"line":12,"column":0},"generated":{"line":1,"column":382}},{"source":"Controllers/admin/token.js","name":"post","original":{"line":12,"column":15},"generated":{"line":1,"column":397}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":12,"column":20},"generated":{"line":1,"column":399}},{"source":"Controllers/admin/token.js","name":"res","original":{"line":12,"column":25},"generated":{"line":1,"column":401}},{"source":"Controllers/admin/token.js","name":"errors","original":{"line":13,"column":10},"generated":{"line":1,"column":404}},{"source":"Controllers/admin/token.js","name":"errors","original":{"line":13,"column":10},"generated":{"line":1,"column":410}},{"source":"Controllers/admin/token.js","original":{"line":13,"column":19},"generated":{"line":1,"column":413}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":13,"column":36},"generated":{"line":1,"column":415}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":13,"column":36},"generated":{"line":1,"column":417}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":13,"column":36},"generated":{"line":1,"column":435}},{"source":"Controllers/admin/token.js","original":{"line":15,"column":8},"generated":{"line":1,"column":438}},{"source":"Controllers/admin/token.js","name":"errors","original":{"line":15,"column":9},"generated":{"line":1,"column":442}},{"source":"Controllers/admin/token.js","name":"isEmpty","original":{"line":15,"column":16},"generated":{"line":1,"column":444}},{"source":"Controllers/admin/token.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":454}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":16,"column":8},"generated":{"line":1,"column":461}},{"source":"Controllers/admin/token.js","name":"session","original":{"line":16,"column":12},"generated":{"line":1,"column":463}},{"source":"Controllers/admin/token.js","name":"err","original":{"line":16,"column":20},"generated":{"line":1,"column":471}},{"source":"Controllers/admin/token.js","name":"errors","original":{"line":16,"column":26},"generated":{"line":1,"column":475}},{"source":"Controllers/admin/token.js","name":"array","original":{"line":16,"column":33},"generated":{"line":1,"column":477}},{"source":"Controllers/admin/token.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":485}},{"source":"Controllers/admin/token.js","name":"redirect","original":{"line":17,"column":19},"generated":{"line":1,"column":487}},{"source":"Controllers/admin/token.js","original":{"line":17,"column":28},"generated":{"line":1,"column":496}},{"source":"Controllers/admin/token.js","name":"uploadSize","original":{"line":21,"column":10},"generated":{"line":1,"column":517}},{"source":"Controllers/admin/token.js","name":"uploadSize","original":{"line":21,"column":10},"generated":{"line":1,"column":523}},{"source":"Controllers/admin/token.js","original":{"line":21,"column":26},"generated":{"line":1,"column":526}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":21,"column":43},"generated":{"line":1,"column":528}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":21,"column":43},"generated":{"line":1,"column":530}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":21,"column":43},"generated":{"line":1,"column":539}},{"source":"Controllers/admin/token.js","name":"body","original":{"line":21,"column":47},"generated":{"line":1,"column":541}},{"source":"Controllers/admin/token.js","name":"size","original":{"line":21,"column":52},"generated":{"line":1,"column":546}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":21,"column":58},"generated":{"line":1,"column":551}},{"source":"Controllers/admin/token.js","name":"body","original":{"line":21,"column":62},"generated":{"line":1,"column":553}},{"source":"Controllers/admin/token.js","name":"unit","original":{"line":21,"column":67},"generated":{"line":1,"column":558}},{"source":"Controllers/admin/token.js","name":"isAdmin","original":{"line":22,"column":10},"generated":{"line":1,"column":564}},{"source":"Controllers/admin/token.js","original":{"line":22,"column":47},"generated":{"line":1,"column":566}},{"source":"Controllers/admin/token.js","name":"req","original":{"line":22,"column":26},"generated":{"line":1,"column":573}},{"source":"Controllers/admin/token.js","name":"body","original":{"line":22,"column":30},"generated":{"line":1,"column":575}},{"source":"Controllers/admin/token.js","name":"isadmin","original":{"line":22,"column":35},"generated":{"line":1,"column":580}},{"source":"Controllers/admin/token.js","name":"registerToken","original":{"line":23,"column":10},"generated":{"line":1,"column":588}},{"source":"Controllers/admin/token.js","name":"crypto","original":{"line":23,"column":26},"generated":{"line":1,"column":590}},{"source":"Controllers/admin/token.js","name":"createHash","original":{"line":23,"column":33},"generated":{"line":1,"column":592}},{"source":"Controllers/admin/token.js","name":"createHash","original":{"line":23,"column":33},"generated":{"line":1,"column":600}},{"source":"Controllers/admin/token.js","original":{"line":23,"column":44},"generated":{"line":1,"column":611}},{"source":"Controllers/admin/token.js","name":"update","original":{"line":24,"column":33},"generated":{"line":1,"column":619}},{"source":"Controllers/admin/token.js","original":{"line":24,"column":40},"generated":{"line":1,"column":626}},{"source":"Controllers/admin/token.js","name":"Date","original":{"line":24,"column":65},"generated":{"line":1,"column":649}},{"source":"Controllers/admin/token.js","name":"now","original":{"line":24,"column":70},"generated":{"line":1,"column":654}},{"source":"Controllers/admin/token.js","name":"toString","original":{"line":24,"column":76},"generated":{"line":1,"column":660}},{"source":"Controllers/admin/token.js","name":"digest","original":{"line":25,"column":33},"generated":{"line":1,"column":672}},{"source":"Controllers/admin/token.js","original":{"line":25,"column":40},"generated":{"line":1,"column":679}},{"source":"Controllers/admin/token.js","name":"client","original":{"line":29,"column":10},"generated":{"line":1,"column":686}},{"source":"Controllers/admin/token.js","name":"db","original":{"line":29,"column":25},"generated":{"line":1,"column":694}},{"source":"Controllers/admin/token.js","name":"connect","original":{"line":29,"column":28},"generated":{"line":1,"column":696}},{"source":"Controllers/admin/token.js","name":"connect","original":{"line":29,"column":28},"generated":{"line":1,"column":704}},{"source":"Controllers/admin/token.js","name":"client","original":{"line":30,"column":10},"generated":{"line":1,"column":720}},{"source":"Controllers/admin/token.js","name":"query","original":{"line":30,"column":17},"generated":{"line":1,"column":722}},{"source":"Controllers/admin/token.js","original":{"line":30,"column":24},"generated":{"line":1,"column":728}},{"source":"Controllers/admin/token.js","original":{"line":31,"column":58},"generated":{"line":1,"column":863}},{"source":"Controllers/admin/token.js","name":"registerToken","original":{"line":31,"column":59},"generated":{"line":1,"column":864}},{"source":"Controllers/admin/token.js","original":{"line":32,"column":59},"generated":{"line":1,"column":867}},{"source":"Controllers/admin/token.js","name":"uploadSize","original":{"line":33,"column":59},"generated":{"line":1,"column":869}},{"source":"Controllers/admin/token.js","name":"isAdmin","original":{"line":34,"column":59},"generated":{"line":1,"column":871}},{"source":"Controllers/admin/token.js","name":"client","original":{"line":35,"column":10},"generated":{"line":1,"column":881}},{"source":"Controllers/admin/token.js","name":"release","original":{"line":35,"column":17},"generated":{"line":1,"column":883}},{"source":"Controllers/admin/token.js","name":"res","original":{"line":37,"column":4},"generated":{"line":1,"column":893}},{"source":"Controllers/admin/token.js","name":"render","original":{"line":37,"column":8},"generated":{"line":1,"column":895}},{"source":"Controllers/admin/token.js","original":{"line":37,"column":15},"generated":{"line":1,"column":902}},{"source":"Controllers/admin/token.js","original":{"line":37,"column":23},"generated":{"line":1,"column":909}},{"source":"Controllers/admin/token.js","name":"menuItem","original":{"line":38,"column":8},"generated":{"line":1,"column":910}},{"source":"Controllers/admin/token.js","original":{"line":38,"column":18},"generated":{"line":1,"column":919}},{"source":"Controllers/admin/token.js","name":"registerUrl","original":{"line":39,"column":8},"generated":{"line":1,"column":927}},{"source":"Controllers/admin/token.js","name":"process","original":{"line":39,"column":21},"generated":{"line":1,"column":939}},{"source":"Controllers/admin/token.js","name":"env","original":{"line":39,"column":29},"generated":{"line":1,"column":947}},{"source":"Controllers/admin/token.js","name":"SITE_LINK","original":{"line":39,"column":33},"generated":{"line":1,"column":951}},{"source":"Controllers/admin/token.js","original":{"line":39,"column":45},"generated":{"line":1,"column":961}},{"source":"Controllers/admin/token.js","name":"registerToken","original":{"line":39,"column":59},"generated":{"line":1,"column":973}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":977}},{"source":"Controllers/admin/token.js","name":"validate","original":{"line":43,"column":6},"generated":{"line":1,"column":983}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":17},"generated":{"line":1,"column":985}},{"source":"Controllers/admin/token.js","original":{"line":44,"column":4},"generated":{"line":1,"column":987}},{"source":"Controllers/admin/token.js","original":{"line":44,"column":10},"generated":{"line":1,"column":989}},{"source":"Controllers/admin/token.js","original":{"line":44,"column":10},"generated":{"line":1,"column":991}},{"source":"Controllers/admin/token.js","original":{"line":44,"column":10},"generated":{"line":1,"column":998}},{"source":"Controllers/admin/token.js","name":"exists","original":{"line":44,"column":18},"generated":{"line":1,"column":1006}},{"source":"Controllers/admin/token.js","name":"withMessage","original":{"line":44,"column":30},"generated":{"line":1,"column":1015}},{"source":"Controllers/admin/token.js","original":{"line":44,"column":42},"generated":{"line":1,"column":1027}},{"source":"Controllers/admin/token.js","name":"isNumeric","original":{"line":45,"column":18},"generated":{"line":1,"column":1061}},{"source":"Controllers/admin/token.js","name":"withMessage","original":{"line":45,"column":30},"generated":{"line":1,"column":1073}},{"source":"Controllers/admin/token.js","original":{"line":45,"column":42},"generated":{"line":1,"column":1085}},{"source":"Controllers/admin/token.js","name":"isInt","original":{"line":46,"column":18},"generated":{"line":1,"column":1117}},{"source":"Controllers/admin/token.js","name":"withMessage","original":{"line":46,"column":30},"generated":{"line":1,"column":1125}},{"source":"Controllers/admin/token.js","original":{"line":46,"column":42},"generated":{"line":1,"column":1137}},{"source":"Controllers/admin/token.js","name":"isLength","original":{"line":47,"column":18},"generated":{"line":1,"column":1173}},{"source":"Controllers/admin/token.js","original":{"line":47,"column":27},"generated":{"line":1,"column":1182}},{"source":"Controllers/admin/token.js","name":"min","original":{"line":48,"column":21},"generated":{"line":1,"column":1183}},{"source":"Controllers/admin/token.js","original":{"line":48,"column":26},"generated":{"line":1,"column":1187}},{"source":"Controllers/admin/token.js","name":"max","original":{"line":49,"column":21},"generated":{"line":1,"column":1189}},{"source":"Controllers/admin/token.js","original":{"line":49,"column":26},"generated":{"line":1,"column":1193}},{"source":"Controllers/admin/token.js","name":"withMessage","original":{"line":50,"column":20},"generated":{"line":1,"column":1208}},{"source":"Controllers/admin/token.js","original":{"line":50,"column":32},"generated":{"line":1,"column":1220}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":4},"generated":{"line":1,"column":1292}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":10},"generated":{"line":1,"column":1294}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":10},"generated":{"line":1,"column":1296}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":10},"generated":{"line":1,"column":1303}},{"source":"Controllers/admin/token.js","name":"isLength","original":{"line":52,"column":18},"generated":{"line":1,"column":1311}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":27},"generated":{"line":1,"column":1320}},{"source":"Controllers/admin/token.js","name":"min","original":{"line":52,"column":29},"generated":{"line":1,"column":1321}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":34},"generated":{"line":1,"column":1325}},{"source":"Controllers/admin/token.js","name":"max","original":{"line":52,"column":37},"generated":{"line":1,"column":1327}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":42},"generated":{"line":1,"column":1331}},{"source":"Controllers/admin/token.js","name":"withMessage","original":{"line":52,"column":47},"generated":{"line":1,"column":1335}},{"source":"Controllers/admin/token.js","original":{"line":52,"column":59},"generated":{"line":1,"column":1347}},{"source":"Controllers/admin/token.js","name":"isIn","original":{"line":53,"column":18},"generated":{"line":1,"column":1387}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":23},"generated":{"line":1,"column":1392}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":25},"generated":{"line":1,"column":1393}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":30},"generated":{"line":1,"column":1397}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":36},"generated":{"line":1,"column":1402}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":42},"generated":{"line":1,"column":1407}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":48},"generated":{"line":1,"column":1412}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":55},"generated":{"line":1,"column":1418}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":62},"generated":{"line":1,"column":1424}},{"source":"Controllers/admin/token.js","name":"withMessage","original":{"line":53,"column":71},"generated":{"line":1,"column":1432}},{"source":"Controllers/admin/token.js","original":{"line":53,"column":83},"generated":{"line":1,"column":1444}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":1485}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":1493}},{"source":"Controllers/admin/token.js","original":{"line":43,"column":0},"generated":{"line":1,"column":1502}}],"sources":{"Controllers/admin/token.js":"import crypto                      from \"crypto\";\r\nimport { check, validationResult } from 'express-validator/check';\r\nimport db                          from \"../../helpers/database\";\r\nimport formatUploadSize            from \"../../Functions/Token/formatUploadSize\";\r\n\r\nfunction get(req, res) {\r\n    res.render(\"user\", {\r\n        menuItem: \"token\"\r\n    });\r\n}\r\n\r\nasync function post(req, res) {\r\n    const errors = validationResult(req);\r\n\r\n    if (!errors.isEmpty()) {\r\n        req.session.err = errors.array();\r\n        return res.redirect(\"/user/admin/token\");\r\n    }\r\n\r\n    // Generate user information\r\n    const uploadSize    = formatUploadSize(req.body.size, req.body.unit);\r\n    const isAdmin       = req.body.isadmin === \"on\";\r\n    const registerToken = crypto.createHash(\"sha1\")\r\n                                .update(\"You can register now\" + Date.now().toString())\r\n                                .digest(\"hex\");\r\n\r\n    \r\n    // Insert said user\r\n    const client = await db.connect();\r\n    await client.query(`INSERT INTO \"RegisterTokens\" (token, registered, used, uploadsize, isadmin)\r\n                        VALUES ($1, NOW(), $2, $3, $4);`, [registerToken,\r\n                                                           false,\r\n                                                           uploadSize,\r\n                                                           isAdmin]);\r\n    await client.release();\r\n\r\n    res.render(\"user\", {\r\n        menuItem: \"token\",\r\n        registerUrl: process.env.SITE_LINK + \"register/\" + registerToken\r\n    });\r\n}\r\n\r\nconst validate = [\r\n    check(\"size\").exists()   .withMessage(\"You need to set an upload size\")\r\n                 .isNumeric().withMessage(\"Upload size must be a number\")\r\n                 .isInt()    .withMessage(\"Upload size needs to be a number\")\r\n                 .isLength({\r\n                     min: 1,\r\n                     max: 999999999999\r\n                 }).withMessage(\"Upload size can't be less than 1 byte or greater than 1TB (0.91TiB)\"),\r\n\r\n    check(\"unit\").isLength({ min: 1, max: 3 }).withMessage(\"Upload unit needs to be a valid unit\")\r\n                 .isIn([ \"B\", \"kB\", \"MB\", \"GB\", \"KiB\", \"MiB\", \"GiB\" ]).withMessage(\"Upload unit needs to be a valid unit\")\r\n]\r\n\r\nexport { get, post, validate }"},"lineCount":null}},"hash":"4d80d7ab8740b9a5f8dabd2e111e8d1e","cacheData":{"env":{}}}