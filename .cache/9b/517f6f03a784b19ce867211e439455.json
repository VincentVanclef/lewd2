{"id":"Sow7","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":1,"column":21},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Register\\tokenData.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.checkTokenDataForErrors=exports.getTokenData=void 0;var e=r(require(\"../../helpers/database\")),t=r(require(\"moment\"));function r(e){return e&&e.__esModule?e:{default:e}}const a=e=>[{param:\"token\",msg:e}],o=async t=>{const r=await e.default.connect(),a=await r.query('SELECT registered, used, roleid, uploadsize, isadmin\\n                                          FROM \"RegisterTokens\"\\n                                          WHERE token = $1;',[t]);return await r.release(),a.rows[0]};exports.getTokenData=o;const n=e=>{if(!e)return a(\"The token wasn't found\");if(e.used)return a(\"The token has already been used\");const r=(0,t.default)(e.registered),o=(0,t.default)();return(0,t.default)(o).add(-1,\"days\")<r&&r<o?null:a(\"The token is more than a day old\")};exports.checkTokenDataForErrors=n;","map":{"mappings":[{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":0}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":13}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":20}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":35}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":43}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":56}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":57}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":64}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":68}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":76}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":100}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":108}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":126}},{"source":"Functions/Register/tokenData.js","original":{"line":1,"column":0},"generated":{"line":1,"column":128}},{"source":"Functions/Register/tokenData.js","original":{"line":1,"column":0},"generated":{"line":1,"column":132}},{"source":"Functions/Register/tokenData.js","original":{"line":1,"column":0},"generated":{"line":1,"column":134}},{"source":"Functions/Register/tokenData.js","original":{"line":1,"column":0},"generated":{"line":1,"column":136}},{"source":"Functions/Register/tokenData.js","original":{"line":1,"column":0},"generated":{"line":1,"column":144}},{"source":"Functions/Register/tokenData.js","original":{"line":2,"column":0},"generated":{"line":1,"column":171}},{"source":"Functions/Register/tokenData.js","original":{"line":2,"column":0},"generated":{"line":1,"column":173}},{"source":"Functions/Register/tokenData.js","original":{"line":2,"column":0},"generated":{"line":1,"column":175}},{"source":"Functions/Register/tokenData.js","original":{"line":2,"column":0},"generated":{"line":1,"column":183}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":194}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":203}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":205}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":208}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":215}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":218}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":220}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":231}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":233}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":234}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":242}},{"source":"Functions/Register/tokenData.js","original":{"line":4,"column":0},"generated":{"line":1,"column":245}},{"source":"Functions/Register/tokenData.js","name":"tokenError","original":{"line":4,"column":6},"generated":{"line":1,"column":251}},{"source":"Functions/Register/tokenData.js","name":"error","original":{"line":4,"column":19},"generated":{"line":1,"column":253}},{"source":"Functions/Register/tokenData.js","original":{"line":4,"column":28},"generated":{"line":1,"column":256}},{"source":"Functions/Register/tokenData.js","original":{"line":4,"column":29},"generated":{"line":1,"column":257}},{"source":"Functions/Register/tokenData.js","original":{"line":5,"column":13},"generated":{"line":1,"column":258}},{"source":"Functions/Register/tokenData.js","original":{"line":5,"column":13},"generated":{"line":1,"column":264}},{"source":"Functions/Register/tokenData.js","name":"error","original":{"line":6,"column":11},"generated":{"line":1,"column":272}},{"source":"Functions/Register/tokenData.js","name":"error","original":{"line":6,"column":11},"generated":{"line":1,"column":276}},{"source":"Functions/Register/tokenData.js","name":"getTokenData","original":{"line":13,"column":6},"generated":{"line":1,"column":280}},{"source":"Functions/Register/tokenData.js","original":{"line":13,"column":21},"generated":{"line":1,"column":282}},{"source":"Functions/Register/tokenData.js","original":{"line":13,"column":21},"generated":{"line":1,"column":288}},{"source":"Functions/Register/tokenData.js","name":"client","original":{"line":14,"column":10},"generated":{"line":1,"column":292}},{"source":"Functions/Register/tokenData.js","name":"client","original":{"line":14,"column":10},"generated":{"line":1,"column":298}},{"source":"Functions/Register/tokenData.js","name":"db","original":{"line":14,"column":28},"generated":{"line":1,"column":306}},{"source":"Functions/Register/tokenData.js","name":"connect","original":{"line":14,"column":31},"generated":{"line":1,"column":308}},{"source":"Functions/Register/tokenData.js","name":"connect","original":{"line":14,"column":31},"generated":{"line":1,"column":316}},{"source":"Functions/Register/tokenData.js","name":"getClient","original":{"line":15,"column":10},"generated":{"line":1,"column":326}},{"source":"Functions/Register/tokenData.js","name":"client","original":{"line":15,"column":28},"generated":{"line":1,"column":334}},{"source":"Functions/Register/tokenData.js","name":"query","original":{"line":15,"column":35},"generated":{"line":1,"column":336}},{"source":"Functions/Register/tokenData.js","original":{"line":15,"column":42},"generated":{"line":1,"column":342}},{"source":"Functions/Register/tokenData.js","original":{"line":17,"column":62},"generated":{"line":1,"column":523}},{"source":"Functions/Register/tokenData.js","name":"token","original":{"line":17,"column":63},"generated":{"line":1,"column":524}},{"source":"Functions/Register/tokenData.js","name":"getClient","original":{"line":20,"column":11},"generated":{"line":1,"column":528}},{"source":"Functions/Register/tokenData.js","name":"client","original":{"line":18,"column":28},"generated":{"line":1,"column":541}},{"source":"Functions/Register/tokenData.js","name":"release","original":{"line":18,"column":35},"generated":{"line":1,"column":543}},{"source":"Functions/Register/tokenData.js","name":"getClient","original":{"line":20,"column":11},"generated":{"line":1,"column":553}},{"source":"Functions/Register/tokenData.js","name":"rows","original":{"line":20,"column":21},"generated":{"line":1,"column":555}},{"source":"Functions/Register/tokenData.js","original":{"line":20,"column":26},"generated":{"line":1,"column":560}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":564}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":572}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":585}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":587}},{"source":"Functions/Register/tokenData.js","name":"checkTokenDataForErrors","original":{"line":28,"column":6},"generated":{"line":1,"column":593}},{"source":"Functions/Register/tokenData.js","name":"tokenData","original":{"line":28,"column":32},"generated":{"line":1,"column":595}},{"source":"Functions/Register/tokenData.js","original":{"line":30,"column":8},"generated":{"line":1,"column":599}},{"source":"Functions/Register/tokenData.js","name":"tokenData","original":{"line":30,"column":9},"generated":{"line":1,"column":603}},{"source":"Functions/Register/tokenData.js","original":{"line":31,"column":8},"generated":{"line":1,"column":605}},{"source":"Functions/Register/tokenData.js","name":"tokenError","original":{"line":31,"column":15},"generated":{"line":1,"column":612}},{"source":"Functions/Register/tokenData.js","original":{"line":31,"column":26},"generated":{"line":1,"column":614}},{"source":"Functions/Register/tokenData.js","name":"tokenData","original":{"line":34,"column":8},"generated":{"line":1,"column":640}},{"source":"Functions/Register/tokenData.js","name":"tokenData","original":{"line":34,"column":8},"generated":{"line":1,"column":643}},{"source":"Functions/Register/tokenData.js","name":"used","original":{"line":34,"column":18},"generated":{"line":1,"column":645}},{"source":"Functions/Register/tokenData.js","original":{"line":35,"column":8},"generated":{"line":1,"column":650}},{"source":"Functions/Register/tokenData.js","name":"tokenError","original":{"line":35,"column":15},"generated":{"line":1,"column":657}},{"source":"Functions/Register/tokenData.js","original":{"line":35,"column":26},"generated":{"line":1,"column":659}},{"source":"Functions/Register/tokenData.js","name":"registered","original":{"line":37,"column":10},"generated":{"line":1,"column":694}},{"source":"Functions/Register/tokenData.js","name":"registered","original":{"line":37,"column":10},"generated":{"line":1,"column":700}},{"source":"Functions/Register/tokenData.js","original":{"line":37,"column":23},"generated":{"line":1,"column":703}},{"source":"Functions/Register/tokenData.js","name":"tokenData","original":{"line":37,"column":30},"generated":{"line":1,"column":705}},{"source":"Functions/Register/tokenData.js","name":"tokenData","original":{"line":37,"column":30},"generated":{"line":1,"column":707}},{"source":"Functions/Register/tokenData.js","name":"tokenData","original":{"line":37,"column":30},"generated":{"line":1,"column":716}},{"source":"Functions/Register/tokenData.js","name":"registered","original":{"line":37,"column":40},"generated":{"line":1,"column":718}},{"source":"Functions/Register/tokenData.js","name":"now","original":{"line":38,"column":10},"generated":{"line":1,"column":730}},{"source":"Functions/Register/tokenData.js","original":{"line":38,"column":23},"generated":{"line":1,"column":733}},{"source":"Functions/Register/tokenData.js","original":{"line":38,"column":4},"generated":{"line":1,"column":735}},{"source":"Functions/Register/tokenData.js","original":{"line":38,"column":4},"generated":{"line":1,"column":737}},{"source":"Functions/Register/tokenData.js","original":{"line":42,"column":8},"generated":{"line":1,"column":748}},{"source":"Functions/Register/tokenData.js","original":{"line":39,"column":23},"generated":{"line":1,"column":755}},{"source":"Functions/Register/tokenData.js","name":"now","original":{"line":39,"column":30},"generated":{"line":1,"column":757}},{"source":"Functions/Register/tokenData.js","name":"now","original":{"line":39,"column":30},"generated":{"line":1,"column":759}},{"source":"Functions/Register/tokenData.js","name":"now","original":{"line":39,"column":30},"generated":{"line":1,"column":768}},{"source":"Functions/Register/tokenData.js","name":"add","original":{"line":39,"column":35},"generated":{"line":1,"column":771}},{"source":"Functions/Register/tokenData.js","original":{"line":39,"column":40},"generated":{"line":1,"column":776}},{"source":"Functions/Register/tokenData.js","original":{"line":39,"column":43},"generated":{"line":1,"column":778}},{"source":"Functions/Register/tokenData.js","name":"registered","original":{"line":42,"column":17},"generated":{"line":1,"column":786}},{"source":"Functions/Register/tokenData.js","name":"registered","original":{"line":42,"column":31},"generated":{"line":1,"column":789}},{"source":"Functions/Register/tokenData.js","name":"now","original":{"line":42,"column":44},"generated":{"line":1,"column":791}},{"source":"Functions/Register/tokenData.js","original":{"line":46,"column":11},"generated":{"line":1,"column":793}},{"source":"Functions/Register/tokenData.js","name":"tokenError","original":{"line":43,"column":15},"generated":{"line":1,"column":798}},{"source":"Functions/Register/tokenData.js","original":{"line":43,"column":26},"generated":{"line":1,"column":800}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":837}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":845}},{"source":"Functions/Register/tokenData.js","original":{"line":28,"column":0},"generated":{"line":1,"column":869}}],"sources":{"Functions/Register/tokenData.js":"import db       from \"../../helpers/database\";\r\nimport moment   from \"moment\";\r\n\r\nconst tokenError = error => [{\r\n    \"param\": \"token\",\r\n    \"msg\": error\r\n}];\r\n\r\n/**\r\n * Get token data from database\r\n * @param {string} token \r\n */\r\nconst getTokenData = async token => {\r\n    const client    = await db.connect();\r\n    const getClient = await client.query(`SELECT registered, used, roleid, uploadsize, isadmin\r\n                                          FROM \"RegisterTokens\"\r\n                                          WHERE token = $1;`, [token]);\r\n                      await client.release();\r\n\r\n    return getClient.rows[0];   \r\n}\r\n\r\n/**\r\n * \r\n * @param {object} tokenData data from the getTokenData function\r\n * @returns {object} An error object if there are errors, and null if there aren't \r\n */\r\nconst checkTokenDataForErrors = tokenData => {\r\n    // Token not found\r\n    if (!tokenData) \r\n        return tokenError(\"The token wasn't found\");\r\n\r\n    // Token used\r\n    if (tokenData.used) \r\n        return tokenError(\"The token has already been used\");\r\n\r\n    const registered = moment(tokenData.registered);\r\n    const now        = moment();\r\n    const then       = moment(now).add(-1, \"days\");\r\n    \r\n    // Check if token is more than a day old\r\n    if (!(then < registered && registered < now)) \r\n        return tokenError(\"The token is more than a day old\");\r\n\r\n    // The token is valid :)\r\n    return null;\r\n};\r\n\r\nexport { getTokenData as getTokenData }\r\nexport { checkTokenDataForErrors as checkTokenDataForErrors }\r\n"},"lineCount":null}},"hash":"ed2bc4d1b02f75e85840772af02842dc","cacheData":{"env":{}}}