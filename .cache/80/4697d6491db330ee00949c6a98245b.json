{"id":"go2J","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":2,"column":30},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Controllers\\admin\\deleteFiles.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"../../Functions/Transparency/logToTransparency","loc":{"line":3,"column":30},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Controllers\\admin\\deleteFiles.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Transparency\\logToTransparency.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.get=s,exports.post=n,exports.validate=void 0;var e=r(require(\"fs\")),t=r(require(\"../../helpers/database\")),a=r(require(\"../../Functions/Transparency/logToTransparency\"));function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){t.render(\"user\",{menuItem:\"remove-files\"})}async function n(r,s){const n=r.body.theLinks.split(\"\\r\\n\");if(!n[0])return;const o=n.map(e=>e.replace(process.env.UPLOAD_LINK,\"\")),i=await t.default.connect();o.forEach(async t=>{const r=process.env.UPLOAD_DESTINATION+t;if(e.default.existsSync(r)){await unlink(r);const e=await i.query('DELETE FROM \"Uploads\"\\n                    WHERE filename = $1 \\n                    RETURNING filesha;',[t]);await(0,a.default)(t,e.rows[0].filesha,\"Google/Katt does not approve\",\"Google/Katt\")}}),await i.release(),s.redirect(\"/user/admin/remove-files\")}const o=[];exports.validate=o;","map":{"mappings":[{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":0}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":13}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":20}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":35}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":43}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":56}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":57}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":64}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":68}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":76}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":80}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":82}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":90}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":95}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":97}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":105}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":119}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":1,"column":0},"generated":{"line":1,"column":121}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":1,"column":0},"generated":{"line":1,"column":125}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":1,"column":0},"generated":{"line":1,"column":127}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":1,"column":0},"generated":{"line":1,"column":129}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":1,"column":0},"generated":{"line":1,"column":137}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":2,"column":0},"generated":{"line":1,"column":144}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":2,"column":0},"generated":{"line":1,"column":146}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":2,"column":0},"generated":{"line":1,"column":148}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":2,"column":0},"generated":{"line":1,"column":156}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":3,"column":0},"generated":{"line":1,"column":183}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":3,"column":0},"generated":{"line":1,"column":185}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":3,"column":0},"generated":{"line":1,"column":187}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":3,"column":0},"generated":{"line":1,"column":195}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":246}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":255}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":257}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":260}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":267}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":270}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":272}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":283}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":285}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":286}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":294}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":5,"column":0},"generated":{"line":1,"column":297}},{"source":"Controllers/admin/deleteFiles.js","name":"get","original":{"line":5,"column":9},"generated":{"line":1,"column":306}},{"source":"Controllers/admin/deleteFiles.js","name":"req","original":{"line":5,"column":13},"generated":{"line":1,"column":308}},{"source":"Controllers/admin/deleteFiles.js","name":"res","original":{"line":5,"column":18},"generated":{"line":1,"column":310}},{"source":"Controllers/admin/deleteFiles.js","name":"res","original":{"line":6,"column":4},"generated":{"line":1,"column":313}},{"source":"Controllers/admin/deleteFiles.js","name":"render","original":{"line":6,"column":8},"generated":{"line":1,"column":315}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":6,"column":15},"generated":{"line":1,"column":322}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":6,"column":23},"generated":{"line":1,"column":329}},{"source":"Controllers/admin/deleteFiles.js","name":"menuItem","original":{"line":7,"column":8},"generated":{"line":1,"column":330}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":7,"column":18},"generated":{"line":1,"column":339}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":11,"column":0},"generated":{"line":1,"column":356}},{"source":"Controllers/admin/deleteFiles.js","name":"post","original":{"line":11,"column":15},"generated":{"line":1,"column":371}},{"source":"Controllers/admin/deleteFiles.js","name":"req","original":{"line":11,"column":20},"generated":{"line":1,"column":373}},{"source":"Controllers/admin/deleteFiles.js","name":"res","original":{"line":11,"column":25},"generated":{"line":1,"column":375}},{"source":"Controllers/admin/deleteFiles.js","name":"linkArray","original":{"line":12,"column":10},"generated":{"line":1,"column":378}},{"source":"Controllers/admin/deleteFiles.js","name":"linkArray","original":{"line":12,"column":10},"generated":{"line":1,"column":384}},{"source":"Controllers/admin/deleteFiles.js","name":"req","original":{"line":12,"column":22},"generated":{"line":1,"column":386}},{"source":"Controllers/admin/deleteFiles.js","name":"body","original":{"line":12,"column":26},"generated":{"line":1,"column":388}},{"source":"Controllers/admin/deleteFiles.js","name":"theLinks","original":{"line":12,"column":31},"generated":{"line":1,"column":393}},{"source":"Controllers/admin/deleteFiles.js","name":"split","original":{"line":12,"column":40},"generated":{"line":1,"column":402}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":12,"column":46},"generated":{"line":1,"column":408}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":14,"column":8},"generated":{"line":1,"column":416}},{"source":"Controllers/admin/deleteFiles.js","name":"linkArray","original":{"line":14,"column":9},"generated":{"line":1,"column":420}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":14,"column":19},"generated":{"line":1,"column":422}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":15,"column":8},"generated":{"line":1,"column":425}},{"source":"Controllers/admin/deleteFiles.js","name":"fileNames","original":{"line":19,"column":10},"generated":{"line":1,"column":432}},{"source":"Controllers/admin/deleteFiles.js","name":"fileNames","original":{"line":19,"column":10},"generated":{"line":1,"column":438}},{"source":"Controllers/admin/deleteFiles.js","name":"linkArray","original":{"line":19,"column":22},"generated":{"line":1,"column":440}},{"source":"Controllers/admin/deleteFiles.js","name":"map","original":{"line":19,"column":32},"generated":{"line":1,"column":442}},{"source":"Controllers/admin/deleteFiles.js","name":"l","original":{"line":19,"column":36},"generated":{"line":1,"column":446}},{"source":"Controllers/admin/deleteFiles.js","name":"l","original":{"line":19,"column":41},"generated":{"line":1,"column":449}},{"source":"Controllers/admin/deleteFiles.js","name":"replace","original":{"line":19,"column":43},"generated":{"line":1,"column":451}},{"source":"Controllers/admin/deleteFiles.js","name":"process","original":{"line":19,"column":51},"generated":{"line":1,"column":459}},{"source":"Controllers/admin/deleteFiles.js","name":"env","original":{"line":19,"column":59},"generated":{"line":1,"column":467}},{"source":"Controllers/admin/deleteFiles.js","name":"UPLOAD_LINK","original":{"line":19,"column":63},"generated":{"line":1,"column":471}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":19,"column":76},"generated":{"line":1,"column":483}},{"source":"Controllers/admin/deleteFiles.js","name":"client","original":{"line":21,"column":10},"generated":{"line":1,"column":488}},{"source":"Controllers/admin/deleteFiles.js","name":"db","original":{"line":21,"column":28},"generated":{"line":1,"column":496}},{"source":"Controllers/admin/deleteFiles.js","name":"connect","original":{"line":21,"column":31},"generated":{"line":1,"column":498}},{"source":"Controllers/admin/deleteFiles.js","name":"connect","original":{"line":21,"column":31},"generated":{"line":1,"column":506}},{"source":"Controllers/admin/deleteFiles.js","name":"fileNames","original":{"line":23,"column":4},"generated":{"line":1,"column":516}},{"source":"Controllers/admin/deleteFiles.js","name":"forEach","original":{"line":23,"column":14},"generated":{"line":1,"column":518}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":23,"column":22},"generated":{"line":1,"column":526}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":23,"column":22},"generated":{"line":1,"column":532}},{"source":"Controllers/admin/deleteFiles.js","name":"fullFileName","original":{"line":24,"column":14},"generated":{"line":1,"column":536}},{"source":"Controllers/admin/deleteFiles.js","name":"fullFileName","original":{"line":24,"column":14},"generated":{"line":1,"column":542}},{"source":"Controllers/admin/deleteFiles.js","name":"process","original":{"line":24,"column":29},"generated":{"line":1,"column":544}},{"source":"Controllers/admin/deleteFiles.js","name":"env","original":{"line":24,"column":37},"generated":{"line":1,"column":552}},{"source":"Controllers/admin/deleteFiles.js","name":"UPLOAD_DESTINATION","original":{"line":24,"column":41},"generated":{"line":1,"column":556}},{"source":"Controllers/admin/deleteFiles.js","name":"fileName","original":{"line":24,"column":62},"generated":{"line":1,"column":575}},{"source":"Controllers/admin/deleteFiles.js","name":"fs","original":{"line":26,"column":12},"generated":{"line":1,"column":577}},{"source":"Controllers/admin/deleteFiles.js","name":"fs","original":{"line":26,"column":12},"generated":{"line":1,"column":580}},{"source":"Controllers/admin/deleteFiles.js","name":"existsSync","original":{"line":26,"column":15},"generated":{"line":1,"column":582}},{"source":"Controllers/admin/deleteFiles.js","name":"existsSync","original":{"line":26,"column":15},"generated":{"line":1,"column":590}},{"source":"Controllers/admin/deleteFiles.js","name":"fullFileName","original":{"line":26,"column":26},"generated":{"line":1,"column":601}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":26,"column":41},"generated":{"line":1,"column":604}},{"source":"Controllers/admin/deleteFiles.js","name":"unlink","original":{"line":27,"column":18},"generated":{"line":1,"column":611}},{"source":"Controllers/admin/deleteFiles.js","name":"fullFileName","original":{"line":27,"column":25},"generated":{"line":1,"column":618}},{"source":"Controllers/admin/deleteFiles.js","name":"fileSha","original":{"line":28,"column":18},"generated":{"line":1,"column":621}},{"source":"Controllers/admin/deleteFiles.js","name":"fileSha","original":{"line":28,"column":18},"generated":{"line":1,"column":627}},{"source":"Controllers/admin/deleteFiles.js","name":"client","original":{"line":28,"column":34},"generated":{"line":1,"column":635}},{"source":"Controllers/admin/deleteFiles.js","name":"query","original":{"line":28,"column":41},"generated":{"line":1,"column":637}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":28,"column":48},"generated":{"line":1,"column":643}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":30,"column":41},"generated":{"line":1,"column":749}},{"source":"Controllers/admin/deleteFiles.js","name":"fileName","original":{"line":31,"column":16},"generated":{"line":1,"column":750}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":34,"column":18},"generated":{"line":1,"column":760}},{"source":"Controllers/admin/deleteFiles.js","name":"fileName","original":{"line":34,"column":36},"generated":{"line":1,"column":762}},{"source":"Controllers/admin/deleteFiles.js","name":"fileName","original":{"line":34,"column":36},"generated":{"line":1,"column":764}},{"source":"Controllers/admin/deleteFiles.js","name":"fileName","original":{"line":34,"column":36},"generated":{"line":1,"column":773}},{"source":"Controllers/admin/deleteFiles.js","name":"fileSha","original":{"line":34,"column":46},"generated":{"line":1,"column":775}},{"source":"Controllers/admin/deleteFiles.js","name":"rows","original":{"line":34,"column":54},"generated":{"line":1,"column":777}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":34,"column":59},"generated":{"line":1,"column":782}},{"source":"Controllers/admin/deleteFiles.js","name":"filesha","original":{"line":34,"column":62},"generated":{"line":1,"column":785}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":34,"column":71},"generated":{"line":1,"column":793}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":34,"column":103},"generated":{"line":1,"column":824}},{"source":"Controllers/admin/deleteFiles.js","name":"client","original":{"line":38,"column":10},"generated":{"line":1,"column":848}},{"source":"Controllers/admin/deleteFiles.js","name":"release","original":{"line":38,"column":17},"generated":{"line":1,"column":850}},{"source":"Controllers/admin/deleteFiles.js","name":"res","original":{"line":39,"column":4},"generated":{"line":1,"column":860}},{"source":"Controllers/admin/deleteFiles.js","name":"redirect","original":{"line":39,"column":8},"generated":{"line":1,"column":862}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":39,"column":17},"generated":{"line":1,"column":871}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":899}},{"source":"Controllers/admin/deleteFiles.js","name":"validate","original":{"line":42,"column":6},"generated":{"line":1,"column":905}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":17},"generated":{"line":1,"column":907}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":910}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":918}},{"source":"Controllers/admin/deleteFiles.js","original":{"line":42,"column":0},"generated":{"line":1,"column":927}}],"sources":{"Controllers/admin/deleteFiles.js":"import fs                from \"fs\";\r\nimport db                from \"../../helpers/database\";\r\nimport logToTransparency from \"../../Functions/Transparency/logToTransparency\";\r\n\r\nfunction get(req, res) {\r\n    res.render(\"user\", {\r\n        menuItem: \"remove-files\"\r\n    });\r\n}\r\n\r\nasync function post(req, res) {\r\n    const linkArray = req.body.theLinks.split(\"\\r\\n\");\r\n\r\n    if (!linkArray[0]) {\r\n        return;\r\n    }\r\n\r\n    // Get array of filenames from linkarray\r\n    const fileNames = linkArray.map(l => l.replace(process.env.UPLOAD_LINK, \"\"));\r\n\r\n    const client    = await db.connect();\r\n\r\n    fileNames.forEach(async fileName => {\r\n        const fullFileName = process.env.UPLOAD_DESTINATION + fileName;\r\n\r\n        if (fs.existsSync(fullFileName)) {\r\n            await unlink(fullFileName);\r\n            const fileSha = await client.query(`DELETE FROM \"Uploads\"\r\n                    WHERE filename = $1 \r\n                    RETURNING filesha;`, [\r\n                fileName\r\n            ]);\r\n\r\n            await logToTransparency(fileName, fileSha.rows[0].filesha, \"Google/Katt does not approve\", \"Google/Katt\");\r\n        }\r\n    });\r\n\r\n    await client.release();\r\n    res.redirect(\"/user/admin/remove-files\");\r\n}\r\n\r\nconst validate = [\r\n\r\n]\r\n\r\nexport { get, post, validate }"},"lineCount":null}},"hash":"b0975f8619560575322bfce3dbfcd129","cacheData":{"env":{}}}