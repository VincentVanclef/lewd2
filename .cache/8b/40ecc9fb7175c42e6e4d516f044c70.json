{"id":"OigL","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":3,"column":40},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Controllers\\admin\\resetPassword.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"../../Functions/Register/checkIfUsernameExists","loc":{"line":4,"column":40},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Controllers\\admin\\resetPassword.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Register\\checkIfUsernameExists.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.get=i,exports.post=o,exports.validate=void 0;var e=require(\"express-validator/check\"),s=a(require(\"crypto\")),r=a(require(\"../../helpers/database\")),t=require(\"../../Functions/Register/checkIfUsernameExists\");function a(e){return e&&e.__esModule?e:{default:e}}function i(e,s){s.render(\"user\",{menuItem:\"reset-password\"})}async function o(t,a){const i=(0,e.validationResult)(t);if(!i.isEmpty())return t.session.err=i.array(),a.redirect(\"/user/admin/reset-password\");const o=s.default.randomBytes(20).toString(\"hex\").slice(0,20),n=await r.default.connect();await n.query('INSERT INTO \"UpdatePasswordKeys\" (\"token\", \"registered\", \"userId\")\\n                        VALUES ($1, NOW(), (SELECT id FROM \"Users\" WHERE username = $2));',[o,t.body.username]),await n.release(),t.flash(\"link\",`${process.env.SITE_LINK}login/forgot-password/${o}`),a.redirect(\"/user/admin/reset-password\")}const n=[(0,e.check)(\"username\").isLength({min:3}).withMessage(\"Username too short\").custom(t.checkIfUsernameExists).withMessage(\"This user does not exist\")];exports.validate=n;","map":{"mappings":[{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":0}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":13}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":20}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":35}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":43}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":56}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":57}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":64}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":68}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":76}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":80}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":82}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":90}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":95}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":97}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":105}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":119}},{"source":"Controllers/admin/resetPassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":121}},{"source":"Controllers/admin/resetPassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":125}},{"source":"Controllers/admin/resetPassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":127}},{"source":"Controllers/admin/resetPassword.js","original":{"line":1,"column":0},"generated":{"line":1,"column":135}},{"source":"Controllers/admin/resetPassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":162}},{"source":"Controllers/admin/resetPassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":164}},{"source":"Controllers/admin/resetPassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":166}},{"source":"Controllers/admin/resetPassword.js","original":{"line":2,"column":0},"generated":{"line":1,"column":174}},{"source":"Controllers/admin/resetPassword.js","original":{"line":3,"column":0},"generated":{"line":1,"column":185}},{"source":"Controllers/admin/resetPassword.js","original":{"line":3,"column":0},"generated":{"line":1,"column":187}},{"source":"Controllers/admin/resetPassword.js","original":{"line":3,"column":0},"generated":{"line":1,"column":189}},{"source":"Controllers/admin/resetPassword.js","original":{"line":3,"column":0},"generated":{"line":1,"column":197}},{"source":"Controllers/admin/resetPassword.js","original":{"line":4,"column":0},"generated":{"line":1,"column":224}},{"source":"Controllers/admin/resetPassword.js","original":{"line":4,"column":0},"generated":{"line":1,"column":226}},{"source":"Controllers/admin/resetPassword.js","original":{"line":4,"column":0},"generated":{"line":1,"column":234}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":284}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":293}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":295}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":298}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":305}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":308}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":310}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":321}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":323}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":324}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":332}},{"source":"Controllers/admin/resetPassword.js","original":{"line":6,"column":0},"generated":{"line":1,"column":335}},{"source":"Controllers/admin/resetPassword.js","name":"get","original":{"line":6,"column":9},"generated":{"line":1,"column":344}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":6,"column":13},"generated":{"line":1,"column":346}},{"source":"Controllers/admin/resetPassword.js","name":"res","original":{"line":6,"column":18},"generated":{"line":1,"column":348}},{"source":"Controllers/admin/resetPassword.js","name":"res","original":{"line":7,"column":4},"generated":{"line":1,"column":351}},{"source":"Controllers/admin/resetPassword.js","name":"render","original":{"line":7,"column":8},"generated":{"line":1,"column":353}},{"source":"Controllers/admin/resetPassword.js","original":{"line":7,"column":15},"generated":{"line":1,"column":360}},{"source":"Controllers/admin/resetPassword.js","original":{"line":7,"column":23},"generated":{"line":1,"column":367}},{"source":"Controllers/admin/resetPassword.js","name":"menuItem","original":{"line":8,"column":8},"generated":{"line":1,"column":368}},{"source":"Controllers/admin/resetPassword.js","original":{"line":8,"column":18},"generated":{"line":1,"column":377}},{"source":"Controllers/admin/resetPassword.js","original":{"line":12,"column":0},"generated":{"line":1,"column":396}},{"source":"Controllers/admin/resetPassword.js","name":"post","original":{"line":12,"column":15},"generated":{"line":1,"column":411}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":12,"column":20},"generated":{"line":1,"column":413}},{"source":"Controllers/admin/resetPassword.js","name":"res","original":{"line":12,"column":25},"generated":{"line":1,"column":415}},{"source":"Controllers/admin/resetPassword.js","name":"errors","original":{"line":13,"column":10},"generated":{"line":1,"column":418}},{"source":"Controllers/admin/resetPassword.js","name":"errors","original":{"line":13,"column":10},"generated":{"line":1,"column":424}},{"source":"Controllers/admin/resetPassword.js","original":{"line":13,"column":19},"generated":{"line":1,"column":427}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":13,"column":36},"generated":{"line":1,"column":429}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":13,"column":36},"generated":{"line":1,"column":431}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":13,"column":36},"generated":{"line":1,"column":449}},{"source":"Controllers/admin/resetPassword.js","original":{"line":15,"column":8},"generated":{"line":1,"column":452}},{"source":"Controllers/admin/resetPassword.js","name":"errors","original":{"line":15,"column":9},"generated":{"line":1,"column":456}},{"source":"Controllers/admin/resetPassword.js","name":"isEmpty","original":{"line":15,"column":16},"generated":{"line":1,"column":458}},{"source":"Controllers/admin/resetPassword.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":468}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":16,"column":8},"generated":{"line":1,"column":475}},{"source":"Controllers/admin/resetPassword.js","name":"session","original":{"line":16,"column":12},"generated":{"line":1,"column":477}},{"source":"Controllers/admin/resetPassword.js","name":"err","original":{"line":16,"column":20},"generated":{"line":1,"column":485}},{"source":"Controllers/admin/resetPassword.js","name":"errors","original":{"line":16,"column":26},"generated":{"line":1,"column":489}},{"source":"Controllers/admin/resetPassword.js","name":"array","original":{"line":16,"column":33},"generated":{"line":1,"column":491}},{"source":"Controllers/admin/resetPassword.js","name":"res","original":{"line":17,"column":15},"generated":{"line":1,"column":499}},{"source":"Controllers/admin/resetPassword.js","name":"redirect","original":{"line":17,"column":19},"generated":{"line":1,"column":501}},{"source":"Controllers/admin/resetPassword.js","original":{"line":17,"column":28},"generated":{"line":1,"column":510}},{"source":"Controllers/admin/resetPassword.js","name":"key","original":{"line":20,"column":10},"generated":{"line":1,"column":540}},{"source":"Controllers/admin/resetPassword.js","name":"key","original":{"line":20,"column":10},"generated":{"line":1,"column":546}},{"source":"Controllers/admin/resetPassword.js","name":"crypto","original":{"line":20,"column":16},"generated":{"line":1,"column":548}},{"source":"Controllers/admin/resetPassword.js","name":"randomBytes","original":{"line":20,"column":23},"generated":{"line":1,"column":550}},{"source":"Controllers/admin/resetPassword.js","name":"randomBytes","original":{"line":20,"column":23},"generated":{"line":1,"column":558}},{"source":"Controllers/admin/resetPassword.js","original":{"line":20,"column":35},"generated":{"line":1,"column":570}},{"source":"Controllers/admin/resetPassword.js","name":"toString","original":{"line":21,"column":23},"generated":{"line":1,"column":574}},{"source":"Controllers/admin/resetPassword.js","original":{"line":21,"column":32},"generated":{"line":1,"column":583}},{"source":"Controllers/admin/resetPassword.js","name":"slice","original":{"line":22,"column":23},"generated":{"line":1,"column":590}},{"source":"Controllers/admin/resetPassword.js","original":{"line":22,"column":29},"generated":{"line":1,"column":596}},{"source":"Controllers/admin/resetPassword.js","original":{"line":22,"column":32},"generated":{"line":1,"column":598}},{"source":"Controllers/admin/resetPassword.js","name":"client","original":{"line":24,"column":10},"generated":{"line":1,"column":602}},{"source":"Controllers/admin/resetPassword.js","name":"db","original":{"line":24,"column":25},"generated":{"line":1,"column":610}},{"source":"Controllers/admin/resetPassword.js","name":"connect","original":{"line":24,"column":28},"generated":{"line":1,"column":612}},{"source":"Controllers/admin/resetPassword.js","name":"connect","original":{"line":24,"column":28},"generated":{"line":1,"column":620}},{"source":"Controllers/admin/resetPassword.js","name":"client","original":{"line":25,"column":10},"generated":{"line":1,"column":636}},{"source":"Controllers/admin/resetPassword.js","name":"query","original":{"line":25,"column":17},"generated":{"line":1,"column":638}},{"source":"Controllers/admin/resetPassword.js","original":{"line":25,"column":24},"generated":{"line":1,"column":644}},{"source":"Controllers/admin/resetPassword.js","original":{"line":27,"column":24},"generated":{"line":1,"column":804}},{"source":"Controllers/admin/resetPassword.js","name":"key","original":{"line":27,"column":25},"generated":{"line":1,"column":805}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":27,"column":30},"generated":{"line":1,"column":807}},{"source":"Controllers/admin/resetPassword.js","name":"body","original":{"line":27,"column":34},"generated":{"line":1,"column":809}},{"source":"Controllers/admin/resetPassword.js","name":"username","original":{"line":27,"column":39},"generated":{"line":1,"column":814}},{"source":"Controllers/admin/resetPassword.js","name":"client","original":{"line":28,"column":10},"generated":{"line":1,"column":831}},{"source":"Controllers/admin/resetPassword.js","name":"release","original":{"line":28,"column":17},"generated":{"line":1,"column":833}},{"source":"Controllers/admin/resetPassword.js","name":"req","original":{"line":29,"column":4},"generated":{"line":1,"column":843}},{"source":"Controllers/admin/resetPassword.js","name":"flash","original":{"line":29,"column":8},"generated":{"line":1,"column":845}},{"source":"Controllers/admin/resetPassword.js","original":{"line":29,"column":14},"generated":{"line":1,"column":851}},{"source":"Controllers/admin/resetPassword.js","name":"process","original":{"line":29,"column":25},"generated":{"line":1,"column":861}},{"source":"Controllers/admin/resetPassword.js","name":"env","original":{"line":29,"column":33},"generated":{"line":1,"column":869}},{"source":"Controllers/admin/resetPassword.js","name":"SITE_LINK","original":{"line":29,"column":37},"generated":{"line":1,"column":873}},{"source":"Controllers/admin/resetPassword.js","name":"key","original":{"line":29,"column":71},"generated":{"line":1,"column":907}},{"source":"Controllers/admin/resetPassword.js","name":"res","original":{"line":31,"column":4},"generated":{"line":1,"column":912}},{"source":"Controllers/admin/resetPassword.js","name":"redirect","original":{"line":31,"column":8},"generated":{"line":1,"column":914}},{"source":"Controllers/admin/resetPassword.js","original":{"line":31,"column":17},"generated":{"line":1,"column":923}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":953}},{"source":"Controllers/admin/resetPassword.js","name":"validate","original":{"line":34,"column":6},"generated":{"line":1,"column":959}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":17},"generated":{"line":1,"column":961}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":4},"generated":{"line":1,"column":963}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":10},"generated":{"line":1,"column":965}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":10},"generated":{"line":1,"column":967}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":10},"generated":{"line":1,"column":974}},{"source":"Controllers/admin/resetPassword.js","name":"isLength","original":{"line":35,"column":22},"generated":{"line":1,"column":986}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":31},"generated":{"line":1,"column":995}},{"source":"Controllers/admin/resetPassword.js","name":"min","original":{"line":35,"column":33},"generated":{"line":1,"column":996}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":38},"generated":{"line":1,"column":1000}},{"source":"Controllers/admin/resetPassword.js","name":"withMessage","original":{"line":35,"column":52},"generated":{"line":1,"column":1004}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":64},"generated":{"line":1,"column":1016}},{"source":"Controllers/admin/resetPassword.js","name":"custom","original":{"line":36,"column":22},"generated":{"line":1,"column":1038}},{"source":"Controllers/admin/resetPassword.js","name":"checkIfUsernameExists","original":{"line":36,"column":29},"generated":{"line":1,"column":1045}},{"source":"Controllers/admin/resetPassword.js","original":{"line":35,"column":4},"generated":{"line":1,"column":1047}},{"source":"Controllers/admin/resetPassword.js","name":"withMessage","original":{"line":36,"column":52},"generated":{"line":1,"column":1070}},{"source":"Controllers/admin/resetPassword.js","original":{"line":36,"column":64},"generated":{"line":1,"column":1082}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":1111}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":1119}},{"source":"Controllers/admin/resetPassword.js","original":{"line":34,"column":0},"generated":{"line":1,"column":1128}}],"sources":{"Controllers/admin/resetPassword.js":"import { check, validationResult } from 'express-validator/check';\r\nimport crypto                      from \"crypto\";\r\nimport db                          from \"../../helpers/database\";\r\nimport { checkIfUsernameExists }   from \"../../Functions/Register/checkIfUsernameExists\";\r\n\r\nfunction get(req, res) {\r\n    res.render(\"user\", {\r\n        menuItem: \"reset-password\"\r\n    });\r\n}\r\n\r\nasync function post(req, res) {\r\n    const errors = validationResult(req);\r\n\r\n    if (!errors.isEmpty()) {\r\n        req.session.err = errors.array();\r\n        return res.redirect(\"/user/admin/reset-password\");\r\n    }\r\n\r\n    const key = crypto.randomBytes(20)\r\n                      .toString(\"hex\")\r\n                      .slice(0, 20);\r\n\r\n    const client = await db.connect();\r\n    await client.query(`INSERT INTO \"UpdatePasswordKeys\" (\"token\", \"registered\", \"userId\")\r\n                        VALUES ($1, NOW(), (SELECT id FROM \"Users\" WHERE username = $2));`, \r\n                        [key, req.body.username]);\r\n    await client.release();\r\n    req.flash(\"link\", `${process.env.SITE_LINK}login/forgot-password/${key}`);\r\n\r\n    res.redirect(\"/user/admin/reset-password\");\r\n}\r\n\r\nconst validate = [\r\n    check(\"username\").isLength({ min: 3 })         .withMessage(\"Username too short\")\r\n                     .custom(checkIfUsernameExists).withMessage(\"This user does not exist\")\r\n\r\n];\r\n\r\nexport { get, post, validate }"},"lineCount":null}},"hash":"f655dddd5958e443a442f166c3a06fa3","cacheData":{"env":{}}}