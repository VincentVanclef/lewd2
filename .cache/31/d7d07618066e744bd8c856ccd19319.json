{"id":"ARr2","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":4,"column":30},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\scanAndRemoveFile.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"../Transparency/logToTransparency","loc":{"line":5,"column":30},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\scanAndRemoveFile.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Transparency\\logToTransparency.js"},{"name":"../sleep","loc":{"line":6,"column":30},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\scanAndRemoveFile.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\sleep.js"},{"name":"../FileDeletion/deleteFiles","loc":{"line":7,"column":30},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\scanAndRemoveFile.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\FileDeletion\\deleteFiles.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var s=a(require(\"fs\")),u=require(\"util\"),r=require(\"child_process\"),t=a(require(\"../../helpers/database\")),p=a(require(\"../Transparency/logToTransparency\")),c=a(require(\"../sleep\")),o=a(require(\"../FileDeletion/deleteFiles\")),i=a(require(\"debug\"));function a(s){return s&&s.__esModule?s:{default:s}}const e=(0,u.promisify)(s.default.unlink),n=(s,u)=>new Promise((t,c)=>{(0,i.default)(\"sophos\")(u);const a=process.env.UPLOAD_DESTINATION+s,e=(0,r.spawn)(\"/opt/sophos-av/bin/savscan\",[\"-nc\",\"-nb\",\"-ss\",\"-archive\",\"-suspicious\",a]);let n=\"\";e.stdout.on(\"data\",async s=>{n+=s}),e.on(\"close\",async r=>{if(0===r)t(s);else if(3===r||2===r){const r=await(0,o.default)([s],\"Sophos\"),c=n.split(\"\\n\")[1].split(\">>> \")[1];r&&await(0,p.default)(s,u,c,\"Sophos\"),t(null)}else console.log(\"??\")})});var d=n;exports.default=d;","map":{"mappings":[{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":0}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":13}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":20}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":35}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":43}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":56}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":57}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":64}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":68}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":76}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":89}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":1,"column":0},"generated":{"line":1,"column":99}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":1,"column":0},"generated":{"line":1,"column":107}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":2,"column":0},"generated":{"line":1,"column":114}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":2,"column":0},"generated":{"line":1,"column":116}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":2,"column":0},"generated":{"line":1,"column":124}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":3,"column":0},"generated":{"line":1,"column":132}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":3,"column":0},"generated":{"line":1,"column":134}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":3,"column":0},"generated":{"line":1,"column":142}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":4,"column":0},"generated":{"line":1,"column":159}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":4,"column":0},"generated":{"line":1,"column":161}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":4,"column":0},"generated":{"line":1,"column":163}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":4,"column":0},"generated":{"line":1,"column":171}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":5,"column":0},"generated":{"line":1,"column":198}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":5,"column":0},"generated":{"line":1,"column":200}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":5,"column":0},"generated":{"line":1,"column":202}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":5,"column":0},"generated":{"line":1,"column":210}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":6,"column":0},"generated":{"line":1,"column":248}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":6,"column":0},"generated":{"line":1,"column":250}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":6,"column":0},"generated":{"line":1,"column":252}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":6,"column":0},"generated":{"line":1,"column":260}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":7,"column":0},"generated":{"line":1,"column":273}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":7,"column":0},"generated":{"line":1,"column":275}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":7,"column":0},"generated":{"line":1,"column":277}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":7,"column":0},"generated":{"line":1,"column":285}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":8,"column":0},"generated":{"line":1,"column":317}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":8,"column":0},"generated":{"line":1,"column":319}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":8,"column":0},"generated":{"line":1,"column":321}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":8,"column":0},"generated":{"line":1,"column":329}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":339}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":348}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":350}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":353}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":360}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":363}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":365}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":376}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":378}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":379}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":387}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":10,"column":0},"generated":{"line":1,"column":390}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"unlink","original":{"line":10,"column":6},"generated":{"line":1,"column":396}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":10,"column":15},"generated":{"line":1,"column":399}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fs","original":{"line":10,"column":25},"generated":{"line":1,"column":401}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fs","original":{"line":10,"column":25},"generated":{"line":1,"column":403}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fs","original":{"line":10,"column":25},"generated":{"line":1,"column":414}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"unlink","original":{"line":10,"column":28},"generated":{"line":1,"column":416}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"unlink","original":{"line":10,"column":28},"generated":{"line":1,"column":424}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":17,"column":6},"generated":{"line":1,"column":432}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":17,"column":26},"generated":{"line":1,"column":434}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filename","original":{"line":17,"column":27},"generated":{"line":1,"column":435}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fileSha","original":{"line":17,"column":37},"generated":{"line":1,"column":437}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":18,"column":11},"generated":{"line":1,"column":441}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"Promise","original":{"line":18,"column":15},"generated":{"line":1,"column":445}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":18,"column":23},"generated":{"line":1,"column":453}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"resolve","original":{"line":18,"column":24},"generated":{"line":1,"column":454}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"reject","original":{"line":18,"column":33},"generated":{"line":1,"column":456}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":19,"column":16},"generated":{"line":1,"column":462}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":19,"column":16},"generated":{"line":1,"column":464}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":19,"column":16},"generated":{"line":1,"column":466}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":19,"column":16},"generated":{"line":1,"column":475}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":19,"column":16},"generated":{"line":1,"column":484}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fileSha","original":{"line":19,"column":26},"generated":{"line":1,"column":485}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filePath","original":{"line":20,"column":14},"generated":{"line":1,"column":488}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filePath","original":{"line":20,"column":14},"generated":{"line":1,"column":494}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"process","original":{"line":20,"column":25},"generated":{"line":1,"column":496}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"env","original":{"line":20,"column":33},"generated":{"line":1,"column":504}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"UPLOAD_DESTINATION","original":{"line":20,"column":37},"generated":{"line":1,"column":508}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filename","original":{"line":20,"column":58},"generated":{"line":1,"column":527}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanner","original":{"line":21,"column":14},"generated":{"line":1,"column":529}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":21,"column":24},"generated":{"line":1,"column":532}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":21,"column":30},"generated":{"line":1,"column":534}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":21,"column":30},"generated":{"line":1,"column":536}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":21,"column":30},"generated":{"line":1,"column":543}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":21,"column":60},"generated":{"line":1,"column":572}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":21,"column":61},"generated":{"line":1,"column":573}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":22,"column":60},"generated":{"line":1,"column":579}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":23,"column":60},"generated":{"line":1,"column":585}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":24,"column":60},"generated":{"line":1,"column":591}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":25,"column":60},"generated":{"line":1,"column":602}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filePath","original":{"line":26,"column":60},"generated":{"line":1,"column":616}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"info","original":{"line":28,"column":12},"generated":{"line":1,"column":620}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"info","original":{"line":28,"column":12},"generated":{"line":1,"column":624}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":28,"column":19},"generated":{"line":1,"column":626}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanner","original":{"line":30,"column":8},"generated":{"line":1,"column":629}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"stdout","original":{"line":30,"column":16},"generated":{"line":1,"column":631}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"on","original":{"line":30,"column":23},"generated":{"line":1,"column":638}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":30,"column":26},"generated":{"line":1,"column":641}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":30,"column":34},"generated":{"line":1,"column":648}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":30,"column":34},"generated":{"line":1,"column":654}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"info","original":{"line":31,"column":12},"generated":{"line":1,"column":658}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"data","original":{"line":31,"column":20},"generated":{"line":1,"column":661}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanner","original":{"line":34,"column":8},"generated":{"line":1,"column":665}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"on","original":{"line":34,"column":16},"generated":{"line":1,"column":667}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":34,"column":19},"generated":{"line":1,"column":670}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":34,"column":28},"generated":{"line":1,"column":678}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":34,"column":28},"generated":{"line":1,"column":684}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"code","original":{"line":37,"column":16},"generated":{"line":1,"column":688}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":37,"column":25},"generated":{"line":1,"column":691}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"code","original":{"line":37,"column":16},"generated":{"line":1,"column":695}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"resolve","original":{"line":39,"column":16},"generated":{"line":1,"column":697}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filename","original":{"line":39,"column":24},"generated":{"line":1,"column":699}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":40,"column":19},"generated":{"line":1,"column":707}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":40,"column":32},"generated":{"line":1,"column":710}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"code","original":{"line":40,"column":23},"generated":{"line":1,"column":714}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":40,"column":46},"generated":{"line":1,"column":717}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"code","original":{"line":40,"column":37},"generated":{"line":1,"column":721}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":40,"column":49},"generated":{"line":1,"column":723}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fileGotDeleted","original":{"line":42,"column":22},"generated":{"line":1,"column":724}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fileGotDeleted","original":{"line":42,"column":22},"generated":{"line":1,"column":730}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":42,"column":45},"generated":{"line":1,"column":738}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":42,"column":57},"generated":{"line":1,"column":740}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":42,"column":57},"generated":{"line":1,"column":742}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":42,"column":57},"generated":{"line":1,"column":751}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filename","original":{"line":42,"column":58},"generated":{"line":1,"column":752}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":42,"column":69},"generated":{"line":1,"column":755}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"reason","original":{"line":49,"column":22},"generated":{"line":1,"column":765}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"info","original":{"line":49,"column":31},"generated":{"line":1,"column":767}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"split","original":{"line":49,"column":36},"generated":{"line":1,"column":769}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":49,"column":42},"generated":{"line":1,"column":775}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":49,"column":48},"generated":{"line":1,"column":781}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"split","original":{"line":50,"column":36},"generated":{"line":1,"column":784}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":50,"column":42},"generated":{"line":1,"column":790}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":50,"column":50},"generated":{"line":1,"column":798}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fileGotDeleted","original":{"line":52,"column":20},"generated":{"line":1,"column":801}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":53,"column":26},"generated":{"line":1,"column":810}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filename","original":{"line":53,"column":44},"generated":{"line":1,"column":812}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filename","original":{"line":53,"column":44},"generated":{"line":1,"column":814}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"filename","original":{"line":53,"column":44},"generated":{"line":1,"column":823}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"fileSha","original":{"line":53,"column":54},"generated":{"line":1,"column":825}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"reason","original":{"line":53,"column":63},"generated":{"line":1,"column":827}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":53,"column":71},"generated":{"line":1,"column":829}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"resolve","original":{"line":55,"column":16},"generated":{"line":1,"column":839}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":55,"column":24},"generated":{"line":1,"column":841}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"console","original":{"line":57,"column":16},"generated":{"line":1,"column":852}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"log","original":{"line":57,"column":24},"generated":{"line":1,"column":860}},{"source":"Functions/Upload/scanAndRemoveFile.js","original":{"line":57,"column":28},"generated":{"line":1,"column":864}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":874}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":878}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":880}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":882}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":890}},{"source":"Functions/Upload/scanAndRemoveFile.js","name":"scanAndRemoveFile","original":{"line":64,"column":15},"generated":{"line":1,"column":898}}],"sources":{"Functions/Upload/scanAndRemoveFile.js":"import fs                from \"fs\";\r\nimport { promisify }     from \"util\"\r\nimport { spawn }         from \"child_process\";\r\nimport db                from \"../../helpers/database\";\r\nimport logToTransparency from \"../Transparency/logToTransparency\";\r\nimport sleep             from \"../sleep\";\r\nimport deleteFiles       from \"../FileDeletion/deleteFiles\";\r\nimport debugge           from \"debug\";\r\n\r\nconst unlink = promisify(fs.unlink);\r\n\r\n/**\r\n * \r\n * @param {string} filename The name of the file to scan\r\n * @param {string} fileSha The sha hash of the file to scan\r\n */\r\nconst scanAndRemoveFile = (filename, fileSha) => {\r\n    return new Promise((resolve, reject) => {\r\n        debugge(\"sophos\")(fileSha);\r\n        const filePath = process.env.UPLOAD_DESTINATION + filename;\r\n        const scanner = spawn(\"/opt/sophos-av/bin/savscan\", [\"-nc\", \r\n                                                            \"-nb\", \r\n                                                            \"-ss\",\r\n                                                            \"-archive\", \r\n                                                            \"-suspicious\", \r\n                                                            filePath]);\r\n\r\n        let info = \"\";\r\n\r\n        scanner.stdout.on(\"data\", async data => {\r\n            info += data;\r\n        });\r\n\r\n        scanner.on(\"close\", async code => {\r\n            // Not having this here will cause savscan to report an error. \r\n            // This is in case VirusTotal removes the file first\r\n            if (code === 0) {\r\n                // The file is clean\r\n                resolve(filename);\r\n            } else if (code === 3 || code === 2) {\r\n                // The file contains a virus and/or is password protected\r\n                const fileGotDeleted = await deleteFiles([filename], \"Sophos\");\r\n                \r\n                // By now info will be\r\n                //     1. Useful life of Scan has been exceeded\r\n                //     2. >>> Virus 'EICAR-AV-Test' found in file /home/inaba/Programming/Lewd/build/Public/Uploads/ec3d3e115547_NOT_A_VIRUS.exe \r\n                //     3. Removal successful\r\n                // So only take the second line and remove the >>>\r\n                const reason = info.split(\"\\n\")[1]\r\n                                   .split(\">>> \")[1];\r\n\r\n                if (fileGotDeleted)\r\n                    await logToTransparency(filename, fileSha, reason, \"Sophos\")\r\n\r\n                resolve(null);\r\n            } else {\r\n                console.log(\"??\");\r\n            }\r\n\r\n        });\r\n    });\r\n};\r\n\r\nexport default scanAndRemoveFile;"},"lineCount":null}},"hash":"3ddf00abbfce82a348099e4a5717067d","cacheData":{"env":{}}}