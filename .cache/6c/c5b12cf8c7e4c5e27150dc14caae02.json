{"id":"E1ks","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../../helpers/database","loc":{"line":2,"column":24},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\addImageToDatabase.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"./deletionKey","loc":{"line":3,"column":24},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\addImageToDatabase.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Upload\\deletionKey.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=i(require(\"js-string-escape\")),a=i(require(\"../../helpers/database\")),t=i(require(\"./deletionKey\"));function i(e){return e&&e.__esModule?e:{default:e}}const l=async(e,i)=>{const l=await a.default.connect();let r=!0;do{e.deletionKey=(0,t.default)(10),r=null!=(await l.query('SELECT id FROM \"Uploads\" WHERE deletionkey = $1;',[e.deletionKey])).rows[0]}while(r);await l.query('INSERT INTO \"Uploads\" (filename, originalName, filesha, userid, duplicate, uploaddate, deletionkey, size) \\n                                             VALUES ($1, $2, $3, $4, $5, NOW(), $6, $7);',[e.filename,e.originalname,e.hash,i,e.duplicate.toString(),e.deletionKey,e.size]);await l.release()};var r=l;exports.default=r;","map":{"mappings":[{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":0}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":13}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":20}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":35}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":43}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":56}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":57}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":64}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":68}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":76}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":89}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":1,"column":0},"generated":{"line":1,"column":91}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":1,"column":0},"generated":{"line":1,"column":95}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":1,"column":0},"generated":{"line":1,"column":97}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":1,"column":0},"generated":{"line":1,"column":99}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":1,"column":0},"generated":{"line":1,"column":107}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":2,"column":0},"generated":{"line":1,"column":128}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":2,"column":0},"generated":{"line":1,"column":130}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":2,"column":0},"generated":{"line":1,"column":132}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":2,"column":0},"generated":{"line":1,"column":140}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":3,"column":0},"generated":{"line":1,"column":167}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":3,"column":0},"generated":{"line":1,"column":169}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":3,"column":0},"generated":{"line":1,"column":171}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":3,"column":0},"generated":{"line":1,"column":179}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":197}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":206}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":208}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":211}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":218}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":221}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":223}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":234}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":236}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":237}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":245}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":0},"generated":{"line":1,"column":248}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":10,"column":6},"generated":{"line":1,"column":254}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":10,"column":27},"generated":{"line":1,"column":256}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":10,"column":34},"generated":{"line":1,"column":262}},{"source":"Functions/Upload/addImageToDatabase.js","name":"userid","original":{"line":10,"column":40},"generated":{"line":1,"column":264}},{"source":"Functions/Upload/addImageToDatabase.js","name":"client","original":{"line":11,"column":10},"generated":{"line":1,"column":269}},{"source":"Functions/Upload/addImageToDatabase.js","name":"client","original":{"line":11,"column":10},"generated":{"line":1,"column":275}},{"source":"Functions/Upload/addImageToDatabase.js","name":"db","original":{"line":11,"column":31},"generated":{"line":1,"column":283}},{"source":"Functions/Upload/addImageToDatabase.js","name":"connect","original":{"line":11,"column":34},"generated":{"line":1,"column":285}},{"source":"Functions/Upload/addImageToDatabase.js","name":"connect","original":{"line":11,"column":34},"generated":{"line":1,"column":293}},{"source":"Functions/Upload/addImageToDatabase.js","name":"deltionKeyCheck","original":{"line":13,"column":8},"generated":{"line":1,"column":303}},{"source":"Functions/Upload/addImageToDatabase.js","name":"deltionKeyCheck","original":{"line":13,"column":8},"generated":{"line":1,"column":307}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":13,"column":26},"generated":{"line":1,"column":310}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":16,"column":7},"generated":{"line":1,"column":312}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":16,"column":7},"generated":{"line":1,"column":314}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":17,"column":8},"generated":{"line":1,"column":315}},{"source":"Functions/Upload/addImageToDatabase.js","name":"deletionKey","original":{"line":17,"column":13},"generated":{"line":1,"column":317}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":27},"generated":{"line":1,"column":330}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":39},"generated":{"line":1,"column":332}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":39},"generated":{"line":1,"column":334}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":17,"column":39},"generated":{"line":1,"column":343}},{"source":"Functions/Upload/addImageToDatabase.js","name":"deltionKeyCheck","original":{"line":20,"column":8},"generated":{"line":1,"column":347}},{"source":"Functions/Upload/addImageToDatabase.js","name":"undefined","original":{"line":20,"column":59},"generated":{"line":1,"column":349}},{"source":"Functions/Upload/addImageToDatabase.js","name":"client","original":{"line":19,"column":43},"generated":{"line":1,"column":362}},{"source":"Functions/Upload/addImageToDatabase.js","name":"query","original":{"line":19,"column":50},"generated":{"line":1,"column":364}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":57},"generated":{"line":1,"column":370}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":19,"column":108},"generated":{"line":1,"column":421}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":19,"column":109},"generated":{"line":1,"column":422}},{"source":"Functions/Upload/addImageToDatabase.js","name":"deletionKey","original":{"line":19,"column":114},"generated":{"line":1,"column":424}},{"source":"Functions/Upload/addImageToDatabase.js","name":"rows","original":{"line":20,"column":48},"generated":{"line":1,"column":439}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":20,"column":53},"generated":{"line":1,"column":444}},{"source":"Functions/Upload/addImageToDatabase.js","name":"deltionKeyCheck","original":{"line":22,"column":13},"generated":{"line":1,"column":453}},{"source":"Functions/Upload/addImageToDatabase.js","name":"client","original":{"line":24,"column":31},"generated":{"line":1,"column":462}},{"source":"Functions/Upload/addImageToDatabase.js","name":"query","original":{"line":24,"column":38},"generated":{"line":1,"column":464}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":24,"column":45},"generated":{"line":1,"column":470}},{"source":"Functions/Upload/addImageToDatabase.js","original":{"line":25,"column":91},"generated":{"line":1,"column":669}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":26,"column":49},"generated":{"line":1,"column":670}},{"source":"Functions/Upload/addImageToDatabase.js","name":"filename","original":{"line":26,"column":54},"generated":{"line":1,"column":672}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":27,"column":49},"generated":{"line":1,"column":681}},{"source":"Functions/Upload/addImageToDatabase.js","name":"originalname","original":{"line":27,"column":54},"generated":{"line":1,"column":683}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":28,"column":49},"generated":{"line":1,"column":696}},{"source":"Functions/Upload/addImageToDatabase.js","name":"hash","original":{"line":28,"column":54},"generated":{"line":1,"column":698}},{"source":"Functions/Upload/addImageToDatabase.js","name":"userid","original":{"line":29,"column":49},"generated":{"line":1,"column":703}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":30,"column":49},"generated":{"line":1,"column":705}},{"source":"Functions/Upload/addImageToDatabase.js","name":"duplicate","original":{"line":30,"column":54},"generated":{"line":1,"column":707}},{"source":"Functions/Upload/addImageToDatabase.js","name":"toString","original":{"line":30,"column":64},"generated":{"line":1,"column":717}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":31,"column":49},"generated":{"line":1,"column":728}},{"source":"Functions/Upload/addImageToDatabase.js","name":"deletionKey","original":{"line":31,"column":54},"generated":{"line":1,"column":730}},{"source":"Functions/Upload/addImageToDatabase.js","name":"file","original":{"line":32,"column":49},"generated":{"line":1,"column":742}},{"source":"Functions/Upload/addImageToDatabase.js","name":"size","original":{"line":32,"column":54},"generated":{"line":1,"column":744}},{"source":"Functions/Upload/addImageToDatabase.js","name":"client","original":{"line":34,"column":31},"generated":{"line":1,"column":757}},{"source":"Functions/Upload/addImageToDatabase.js","name":"release","original":{"line":34,"column":38},"generated":{"line":1,"column":759}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":770}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":774}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":776}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":778}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":786}},{"source":"Functions/Upload/addImageToDatabase.js","name":"addImageToDatabase","original":{"line":37,"column":15},"generated":{"line":1,"column":794}}],"sources":{"Functions/Upload/addImageToDatabase.js":"import jsStringEscape      from \"js-string-escape\";\r\nimport db          from \"../../helpers/database\";\r\nimport deletionKey from \"./deletionKey\";\r\n\r\n/**\r\n * \r\n * @param {object} file \r\n * @param {number} userid \r\n */\r\nconst addImageToDatabase = async (file, userid) => {\r\n    const client       = await db.connect();\r\n\r\n    let deltionKeyCheck = true;\r\n\r\n    // Check for unique deletion key\r\n    do {\r\n        file.deletionKey = deletionKey(10);\r\n        \r\n        const fileDeletionKeyCheck = await client.query(`SELECT id FROM \"Uploads\" WHERE deletionkey = $1;`, [file.deletionKey]);\r\n        deltionKeyCheck = (fileDeletionKeyCheck.rows[0] != undefined); // The deletionkey beeds to be unique\r\n                                                                      // IE if the above query is not undefined then it needs to generate a new token\r\n    } while (deltionKeyCheck);\r\n\r\n    const insertUpload = await client.query(`INSERT INTO \"Uploads\" (filename, originalName, filesha, userid, duplicate, uploaddate, deletionkey, size) \r\n                                             VALUES ($1, $2, $3, $4, $5, NOW(), $6, $7);`, [\r\n                                                 file.filename,\r\n                                                 file.originalname, \r\n                                                 file.hash, \r\n                                                 userid, \r\n                                                 file.duplicate.toString(),\r\n                                                 file.deletionKey,\r\n                                                 file.size\r\n                                                ]);\r\n                         await client.release();\r\n};\r\n\r\nexport default addImageToDatabase;"},"lineCount":null}},"hash":"2b64f9770822b43e85444bd2f959e71f","cacheData":{"env":{}}}