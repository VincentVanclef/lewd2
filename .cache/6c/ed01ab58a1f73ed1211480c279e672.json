{"id":"Classes/VirusTotalScanner.js","dependencies":[{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\.babelrc","includedInParent":true,"mtime":1545517173655},{"name":"C:\\Users\\inaba\\Programming\\Lewd2\\package.json","includedInParent":true,"mtime":1545850952595},{"name":"../Functions/sleep","loc":{"line":6,"column":26},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Classes\\VirusTotalScanner.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\sleep.js"},{"name":"../helpers/database","loc":{"line":7,"column":26},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Classes\\VirusTotalScanner.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\helpers\\database.js"},{"name":"../Functions/FileDeletion/deleteFiles","loc":{"line":8,"column":26},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Classes\\VirusTotalScanner.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\FileDeletion\\deleteFiles.js"},{"name":"../Functions/Transparency/logToTransparency","loc":{"line":9,"column":30},"parent":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Classes\\VirusTotalScanner.js","resolved":"C:\\Users\\inaba\\Programming\\Lewd2\\src\\Functions\\Transparency\\logToTransparency.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _https = _interopRequireDefault(require(\"https\"));\n\nvar _querystring = _interopRequireDefault(require(\"querystring\"));\n\nvar _async = _interopRequireDefault(require(\"async\"));\n\nvar _util = require(\"util\");\n\nvar _fs = _interopRequireDefault(require(\"fs\"));\n\nvar _sleep = _interopRequireDefault(require(\"../Functions/sleep\"));\n\nvar _database = _interopRequireDefault(require(\"../helpers/database\"));\n\nvar _deleteFiles = _interopRequireDefault(require(\"../Functions/FileDeletion/deleteFiles\"));\n\nvar _logToTransparency = _interopRequireDefault(require(\"../Functions/Transparency/logToTransparency\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst unlink = (0, _util.promisify)(_fs.default.unlink);\n\nclass VirusTotalScanner {\n  /**\r\n   * \r\n   * @param {String} APIKey \r\n   * @param {Number} waitTime \r\n   * @param {Number} scansPrMinute \r\n   * @param {Number} maximumPositives \r\n   * @param {String} uploadDir \r\n   */\n  constructor(APIKey, waitTime, scansPrMinute, maximumPositives, uploadDir) {\n    this.APIKey = APIKey;\n    this.uploadDir = uploadDir;\n    this.waitTime = parseInt(waitTime);\n    this.scansPrMinute = parseInt(scansPrMinute);\n    this.maximumPositives = parseInt(maximumPositives);\n    this.amountOfScans = 0;\n    this.options = {\n      hostname: \"virustotal.com\",\n      port: \"443\",\n      path: \"/vtapi/v2/file/report\",\n      method: \"POST\",\n      headers: {\n        \"Accept-Encoding\": \"gzip deflate\",\n        \"User-Agent\": \"gzip \" + process.env.VIRUSTOTAL_USER\n      }\n    };\n    this.queue = _async.default.queue(async task => {\n      // This is how the scanner i limited to 4 scans pr minute\n      if (this.amountOfScans == this.scansPrMinute) {\n        await (0, _sleep.default)(this.waitTime);\n        this.amountOfScans = 0;\n      }\n\n      this.amountOfScans++;\n      await this._onScan(task);\n    }, 1);\n  }\n\n  _getFileReport(fileHash) {\n    return new Promise((resolve, reject) => {\n      const postData = _querystring.default.stringify({\n        \"resource\": fileHash,\n        \"apikey\": this.APIKey\n      });\n\n      const req = _https.default.request(this.options, res => {\n        let end = \"\";\n        res.on(\"data\", d => {\n          end += d;\n        });\n        res.on(\"end\", () => {\n          // If for whatever reason VirusTotal doesn't approve of your request it will give you empty string\n          // JSON.parse doesn't like empty string\n          //...\n          const result = end.length === 0 ? null : JSON.parse(end);\n          resolve(result);\n        });\n        res.on(\"error\", e => {\n          reject(e);\n        });\n      });\n\n      req.on(\"error\", e => {\n        reject(e);\n      });\n      req.write(postData);\n      req.end();\n    });\n  }\n\n  async _onScan(task) {\n    const report = await this._getFileReport(task.fileHash); // Should I wait and try again?\n\n    if (report === null) {\n      await this._updateFileVirustotalScanCountInDb(task.fileName, task.scanNumber);\n      return;\n    }\n\n    const virusTotalDemands = report.positives < parseInt(this.maximumPositives) || report.response_code === 0 // The file is not in the database\n    || report.length === 0; // ^\n    // If there are too few positives\n\n    if (virusTotalDemands) {\n      await this._updateFileVirustotalScanCountInDb(task.fileName, task.scanNumber);\n      return;\n    } // Remove the file if there are too many positives\n\n\n    const fileGotDeleted = await (0, _deleteFiles.default)([task.fileName], \"VirusTotal\");\n    if (fileGotDeleted) await (0, _logToTransparency.default)(task.fileName, task.fileHash, report.permalink, \"Virustotal\");\n  }\n  /**\r\n   * \r\n   * @param {*} fileName \r\n   * @param {*} scanNumber \r\n   */\n\n\n  async _updateFileVirustotalScanCountInDb(fileName, scanNumber) {\n    const client = await _database.default.connect();\n    await client.query(`UPDATE \"Uploads\" SET \"virustotalScan\" = $1 WHERE filename = $2;`, [scanNumber, fileName]);\n    await client.release();\n  }\n  /**\r\n   * \r\n   * @param {String} filehash - The files hash \r\n   * @param {String} filename - The name of the file on disk\r\n   * @param {Number} scanNumber - The scan that has been performed\r\n   */\n\n\n  scan(filehash, filename, scanNumber) {\n    this.queue.push({\n      fileHash: filehash,\n      fileName: filename,\n      scanNumber: scanNumber\n    });\n  }\n\n}\n\nvar _default = VirusTotalScanner;\nexports.default = _default;","map":{"mappings":[{"generated":{"line":8,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":1,"column":0}},{"generated":{"line":10,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":2,"column":0}},{"generated":{"line":12,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":3,"column":0}},{"generated":{"line":14,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":4,"column":0}},{"generated":{"line":16,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":5,"column":0}},{"generated":{"line":18,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":6,"column":0}},{"generated":{"line":20,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":7,"column":0}},{"generated":{"line":22,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":8,"column":0}},{"generated":{"line":24,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":9,"column":0}},{"generated":{"line":28,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":0}},{"name":"unlink","generated":{"line":28,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":6}},{"generated":{"line":28,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":12}},{"generated":{"line":28,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":17}},{"name":"fs","generated":{"line":28,"column":36},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":27}},{"name":"unlink","generated":{"line":28,"column":48},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":30}},{"generated":{"line":28,"column":54},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":17}},{"generated":{"line":28,"column":55},"source":"Classes/VirusTotalScanner.js","original":{"line":11,"column":0}},{"generated":{"line":30,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":13,"column":0}},{"name":"VirusTotalScanner","generated":{"line":30,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":13,"column":6}},{"generated":{"line":30,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":13,"column":0}},{"generated":{"line":30,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":13,"column":24}},{"generated":{"line":31,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":14,"column":4}},{"name":"constructor","generated":{"line":39,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":4}},{"name":"constructor","generated":{"line":39,"column":2},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":4}},{"generated":{"line":39,"column":13},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":15}},{"name":"APIKey","generated":{"line":39,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":16}},{"generated":{"line":39,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":15}},{"name":"waitTime","generated":{"line":39,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":24}},{"generated":{"line":39,"column":30},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":15}},{"name":"scansPrMinute","generated":{"line":39,"column":32},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":34}},{"generated":{"line":39,"column":45},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":15}},{"name":"maximumPositives","generated":{"line":39,"column":47},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":49}},{"generated":{"line":39,"column":63},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":15}},{"name":"uploadDir","generated":{"line":39,"column":65},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":67}},{"generated":{"line":39,"column":74},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":15}},{"generated":{"line":39,"column":76},"source":"Classes/VirusTotalScanner.js","original":{"line":22,"column":78}},{"generated":{"line":40,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":23,"column":8}},{"name":"APIKey","generated":{"line":40,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":23,"column":13}},{"generated":{"line":40,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":23,"column":8}},{"name":"APIKey","generated":{"line":40,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":23,"column":32}},{"generated":{"line":40,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":23,"column":8}},{"generated":{"line":41,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":24,"column":8}},{"name":"uploadDir","generated":{"line":41,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":24,"column":13}},{"generated":{"line":41,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":24,"column":8}},{"name":"uploadDir","generated":{"line":41,"column":21},"source":"Classes/VirusTotalScanner.js","original":{"line":24,"column":32}},{"generated":{"line":41,"column":30},"source":"Classes/VirusTotalScanner.js","original":{"line":24,"column":8}},{"generated":{"line":42,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":8}},{"name":"waitTime","generated":{"line":42,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":13}},{"generated":{"line":42,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":8}},{"name":"parseInt","generated":{"line":42,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":32}},{"generated":{"line":42,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":40}},{"name":"waitTime","generated":{"line":42,"column":29},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":41}},{"generated":{"line":42,"column":37},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":40}},{"generated":{"line":42,"column":38},"source":"Classes/VirusTotalScanner.js","original":{"line":25,"column":8}},{"generated":{"line":43,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":8}},{"name":"scansPrMinute","generated":{"line":43,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":13}},{"generated":{"line":43,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":8}},{"name":"parseInt","generated":{"line":43,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":32}},{"generated":{"line":43,"column":33},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":40}},{"name":"scansPrMinute","generated":{"line":43,"column":34},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":41}},{"generated":{"line":43,"column":47},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":40}},{"generated":{"line":43,"column":48},"source":"Classes/VirusTotalScanner.js","original":{"line":26,"column":8}},{"generated":{"line":44,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":8}},{"name":"maximumPositives","generated":{"line":44,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":13}},{"generated":{"line":44,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":8}},{"name":"parseInt","generated":{"line":44,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":32}},{"generated":{"line":44,"column":36},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":40}},{"name":"maximumPositives","generated":{"line":44,"column":37},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":41}},{"generated":{"line":44,"column":53},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":40}},{"generated":{"line":44,"column":54},"source":"Classes/VirusTotalScanner.js","original":{"line":27,"column":8}},{"generated":{"line":45,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":28,"column":8}},{"name":"amountOfScans","generated":{"line":45,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":28,"column":13}},{"generated":{"line":45,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":28,"column":8}},{"generated":{"line":45,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":28,"column":32}},{"generated":{"line":45,"column":26},"source":"Classes/VirusTotalScanner.js","original":{"line":28,"column":8}},{"generated":{"line":46,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":8}},{"name":"options","generated":{"line":46,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":13}},{"generated":{"line":46,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":8}},{"generated":{"line":46,"column":19},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":23}},{"name":"hostname","generated":{"line":47,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":31,"column":12}},{"name":"hostname","generated":{"line":47,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":31,"column":12}},{"generated":{"line":47,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":31,"column":20}},{"generated":{"line":47,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":31,"column":22}},{"generated":{"line":47,"column":32},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":23}},{"name":"port","generated":{"line":48,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":32,"column":12}},{"name":"port","generated":{"line":48,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":32,"column":12}},{"generated":{"line":48,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":32,"column":16}},{"generated":{"line":48,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":32,"column":18}},{"generated":{"line":48,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":23}},{"name":"path","generated":{"line":49,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":33,"column":12}},{"name":"path","generated":{"line":49,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":33,"column":12}},{"generated":{"line":49,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":33,"column":16}},{"generated":{"line":49,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":33,"column":18}},{"generated":{"line":49,"column":35},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":23}},{"name":"method","generated":{"line":50,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":34,"column":12}},{"name":"method","generated":{"line":50,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":34,"column":12}},{"generated":{"line":50,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":34,"column":18}},{"generated":{"line":50,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":34,"column":20}},{"generated":{"line":50,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":23}},{"name":"headers","generated":{"line":51,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":35,"column":12}},{"name":"headers","generated":{"line":51,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":35,"column":12}},{"generated":{"line":51,"column":13},"source":"Classes/VirusTotalScanner.js","original":{"line":35,"column":19}},{"generated":{"line":51,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":35,"column":21}},{"generated":{"line":52,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":36,"column":16}},{"generated":{"line":52,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":36,"column":35}},{"generated":{"line":52,"column":41},"source":"Classes/VirusTotalScanner.js","original":{"line":35,"column":21}},{"generated":{"line":53,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":37,"column":16}},{"generated":{"line":53,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":37,"column":30}},{"name":"process","generated":{"line":53,"column":32},"source":"Classes/VirusTotalScanner.js","original":{"line":37,"column":40}},{"generated":{"line":53,"column":39},"source":"Classes/VirusTotalScanner.js","original":{"line":37,"column":47}},{"name":"env","generated":{"line":53,"column":40},"source":"Classes/VirusTotalScanner.js","original":{"line":37,"column":48}},{"generated":{"line":53,"column":43},"source":"Classes/VirusTotalScanner.js","original":{"line":37,"column":40}},{"name":"VIRUSTOTAL_USER","generated":{"line":53,"column":44},"source":"Classes/VirusTotalScanner.js","original":{"line":37,"column":52}},{"generated":{"line":54,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":35,"column":21}},{"generated":{"line":55,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":23}},{"generated":{"line":55,"column":5},"source":"Classes/VirusTotalScanner.js","original":{"line":30,"column":8}},{"generated":{"line":56,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":8}},{"name":"queue","generated":{"line":56,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":13}},{"generated":{"line":56,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":8}},{"name":"async","generated":{"line":56,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":21}},{"name":"queue","generated":{"line":56,"column":32},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":27}},{"generated":{"line":56,"column":37},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":21}},{"generated":{"line":56,"column":38},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":33}},{"name":"task","generated":{"line":56,"column":44},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":39}},{"generated":{"line":56,"column":48},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":33}},{"generated":{"line":56,"column":52},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":47}},{"generated":{"line":57,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":42,"column":12}},{"generated":{"line":58,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":12}},{"generated":{"line":58,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":16}},{"name":"amountOfScans","generated":{"line":58,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":21}},{"generated":{"line":58,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":16}},{"generated":{"line":58,"column":32},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":38}},{"name":"scansPrMinute","generated":{"line":58,"column":37},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":43}},{"generated":{"line":58,"column":50},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":12}},{"generated":{"line":58,"column":52},"source":"Classes/VirusTotalScanner.js","original":{"line":43,"column":58}},{"generated":{"line":59,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":44,"column":16}},{"generated":{"line":59,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":44,"column":22}},{"generated":{"line":59,"column":34},"source":"Classes/VirusTotalScanner.js","original":{"line":44,"column":28}},{"name":"waitTime","generated":{"line":59,"column":39},"source":"Classes/VirusTotalScanner.js","original":{"line":44,"column":33}},{"generated":{"line":59,"column":47},"source":"Classes/VirusTotalScanner.js","original":{"line":44,"column":22}},{"generated":{"line":59,"column":48},"source":"Classes/VirusTotalScanner.js","original":{"line":44,"column":16}},{"generated":{"line":60,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":45,"column":16}},{"name":"amountOfScans","generated":{"line":60,"column":13},"source":"Classes/VirusTotalScanner.js","original":{"line":45,"column":21}},{"generated":{"line":60,"column":26},"source":"Classes/VirusTotalScanner.js","original":{"line":45,"column":16}},{"generated":{"line":60,"column":29},"source":"Classes/VirusTotalScanner.js","original":{"line":45,"column":37}},{"generated":{"line":60,"column":30},"source":"Classes/VirusTotalScanner.js","original":{"line":45,"column":16}},{"generated":{"line":61,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":46,"column":13}},{"generated":{"line":63,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":47,"column":12}},{"name":"amountOfScans","generated":{"line":63,"column":11},"source":"Classes/VirusTotalScanner.js","original":{"line":47,"column":17}},{"generated":{"line":63,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":47,"column":12}},{"generated":{"line":64,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":49,"column":12}},{"generated":{"line":64,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":49,"column":18}},{"name":"_onScan","generated":{"line":64,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":49,"column":23}},{"generated":{"line":64,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":49,"column":18}},{"name":"task","generated":{"line":64,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":49,"column":31}},{"generated":{"line":64,"column":29},"source":"Classes/VirusTotalScanner.js","original":{"line":49,"column":18}},{"generated":{"line":64,"column":30},"source":"Classes/VirusTotalScanner.js","original":{"line":49,"column":12}},{"generated":{"line":65,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":50,"column":9}},{"generated":{"line":65,"column":5},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":21}},{"generated":{"line":65,"column":7},"source":"Classes/VirusTotalScanner.js","original":{"line":50,"column":11}},{"generated":{"line":65,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":21}},{"generated":{"line":65,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":41,"column":8}},{"generated":{"line":66,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":51,"column":5}},{"name":"_getFileReport","generated":{"line":68,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":53,"column":4}},{"name":"_getFileReport","generated":{"line":68,"column":2},"source":"Classes/VirusTotalScanner.js","original":{"line":53,"column":4}},{"generated":{"line":68,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":53,"column":18}},{"name":"fileHash","generated":{"line":68,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":53,"column":19}},{"generated":{"line":68,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":53,"column":18}},{"generated":{"line":68,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":53,"column":29}},{"generated":{"line":69,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":8}},{"generated":{"line":69,"column":11},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":15}},{"name":"Promise","generated":{"line":69,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":19}},{"generated":{"line":69,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":15}},{"generated":{"line":69,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":27}},{"name":"resolve","generated":{"line":69,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":28}},{"generated":{"line":69,"column":31},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":27}},{"name":"reject","generated":{"line":69,"column":33},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":37}},{"generated":{"line":69,"column":39},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":27}},{"generated":{"line":69,"column":44},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":48}},{"generated":{"line":70,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":12}},{"name":"postData","generated":{"line":70,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":18}},{"generated":{"line":70,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":26}},{"name":"queryString","generated":{"line":70,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":29}},{"name":"stringify","generated":{"line":70,"column":44},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":41}},{"generated":{"line":70,"column":53},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":29}},{"generated":{"line":70,"column":54},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":51}},{"generated":{"line":71,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":56,"column":16}},{"name":"fileHash","generated":{"line":71,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":56,"column":28}},{"generated":{"line":71,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":51}},{"generated":{"line":72,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":57,"column":16}},{"generated":{"line":72,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":57,"column":26}},{"name":"APIKey","generated":{"line":72,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":57,"column":31}},{"generated":{"line":73,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":51}},{"generated":{"line":73,"column":7},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":29}},{"generated":{"line":73,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":55,"column":12}},{"generated":{"line":75,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":12}},{"name":"req","generated":{"line":75,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":18}},{"generated":{"line":75,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":21}},{"name":"https","generated":{"line":75,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":24}},{"name":"request","generated":{"line":75,"column":33},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":30}},{"generated":{"line":75,"column":40},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":24}},{"generated":{"line":75,"column":41},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":38}},{"name":"options","generated":{"line":75,"column":46},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":43}},{"generated":{"line":75,"column":53},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":24}},{"name":"res","generated":{"line":75,"column":55},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":52}},{"generated":{"line":75,"column":58},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":55}},{"generated":{"line":75,"column":62},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":59}},{"generated":{"line":76,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":61,"column":16}},{"name":"end","generated":{"line":76,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":61,"column":20}},{"generated":{"line":76,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":61,"column":23}},{"generated":{"line":76,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":61,"column":26}},{"generated":{"line":76,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":61,"column":16}},{"name":"res","generated":{"line":77,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":16}},{"name":"res","generated":{"line":77,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":16}},{"generated":{"line":77,"column":11},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":19}},{"name":"on","generated":{"line":77,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":20}},{"generated":{"line":77,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":16}},{"generated":{"line":77,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":23}},{"generated":{"line":77,"column":21},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":16}},{"name":"d","generated":{"line":77,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":31}},{"generated":{"line":77,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":32}},{"generated":{"line":77,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":36}},{"name":"end","generated":{"line":78,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":63,"column":20}},{"name":"end","generated":{"line":78,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":63,"column":20}},{"generated":{"line":78,"column":13},"source":"Classes/VirusTotalScanner.js","original":{"line":63,"column":23}},{"name":"d","generated":{"line":78,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":63,"column":27}},{"generated":{"line":78,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":63,"column":20}},{"generated":{"line":79,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":64,"column":17}},{"generated":{"line":79,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":62,"column":16}},{"name":"res","generated":{"line":80,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":16}},{"name":"res","generated":{"line":80,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":16}},{"generated":{"line":80,"column":11},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":19}},{"name":"on","generated":{"line":80,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":20}},{"generated":{"line":80,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":16}},{"generated":{"line":80,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":23}},{"generated":{"line":80,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":16}},{"generated":{"line":80,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":30}},{"generated":{"line":80,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":36}},{"generated":{"line":81,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":67,"column":20}},{"generated":{"line":82,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":68,"column":20}},{"generated":{"line":83,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":69,"column":20}},{"generated":{"line":84,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":20}},{"name":"result","generated":{"line":84,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":26}},{"generated":{"line":84,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":32}},{"name":"end","generated":{"line":84,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":35}},{"generated":{"line":84,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":38}},{"name":"length","generated":{"line":84,"column":29},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":39}},{"generated":{"line":84,"column":35},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":35}},{"generated":{"line":84,"column":40},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":50}},{"generated":{"line":84,"column":41},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":35}},{"generated":{"line":84,"column":44},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":54}},{"generated":{"line":84,"column":48},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":35}},{"name":"JSON","generated":{"line":84,"column":51},"source":"Classes/VirusTotalScanner.js","original":{"line":71,"column":54}},{"generated":{"line":84,"column":55},"source":"Classes/VirusTotalScanner.js","original":{"line":71,"column":58}},{"name":"parse","generated":{"line":84,"column":56},"source":"Classes/VirusTotalScanner.js","original":{"line":71,"column":59}},{"generated":{"line":84,"column":61},"source":"Classes/VirusTotalScanner.js","original":{"line":71,"column":54}},{"name":"end","generated":{"line":84,"column":62},"source":"Classes/VirusTotalScanner.js","original":{"line":71,"column":65}},{"generated":{"line":84,"column":65},"source":"Classes/VirusTotalScanner.js","original":{"line":71,"column":54}},{"generated":{"line":84,"column":66},"source":"Classes/VirusTotalScanner.js","original":{"line":70,"column":20}},{"name":"resolve","generated":{"line":85,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":73,"column":20}},{"name":"resolve","generated":{"line":85,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":73,"column":20}},{"generated":{"line":85,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":73,"column":27}},{"name":"result","generated":{"line":85,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":73,"column":28}},{"generated":{"line":85,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":73,"column":27}},{"generated":{"line":85,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":73,"column":20}},{"generated":{"line":86,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":74,"column":17}},{"generated":{"line":86,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":66,"column":16}},{"name":"res","generated":{"line":87,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":16}},{"name":"res","generated":{"line":87,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":16}},{"generated":{"line":87,"column":11},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":19}},{"name":"on","generated":{"line":87,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":20}},{"generated":{"line":87,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":16}},{"generated":{"line":87,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":23}},{"generated":{"line":87,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":16}},{"name":"e","generated":{"line":87,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":32}},{"generated":{"line":87,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":33}},{"generated":{"line":87,"column":29},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":37}},{"name":"reject","generated":{"line":88,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":77,"column":20}},{"name":"reject","generated":{"line":88,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":77,"column":20}},{"generated":{"line":88,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":77,"column":26}},{"name":"e","generated":{"line":88,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":77,"column":27}},{"generated":{"line":88,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":77,"column":26}},{"generated":{"line":88,"column":19},"source":"Classes/VirusTotalScanner.js","original":{"line":77,"column":20}},{"generated":{"line":89,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":78,"column":17}},{"generated":{"line":89,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":76,"column":16}},{"generated":{"line":90,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":79,"column":13}},{"generated":{"line":90,"column":7},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":24}},{"generated":{"line":90,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":60,"column":12}},{"name":"req","generated":{"line":92,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":12}},{"name":"req","generated":{"line":92,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":12}},{"generated":{"line":92,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":15}},{"name":"on","generated":{"line":92,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":16}},{"generated":{"line":92,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":12}},{"generated":{"line":92,"column":13},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":19}},{"generated":{"line":92,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":12}},{"name":"e","generated":{"line":92,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":28}},{"generated":{"line":92,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":29}},{"generated":{"line":92,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":33}},{"name":"reject","generated":{"line":93,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":82,"column":16}},{"name":"reject","generated":{"line":93,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":82,"column":16}},{"generated":{"line":93,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":82,"column":22}},{"name":"e","generated":{"line":93,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":82,"column":23}},{"generated":{"line":93,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":82,"column":22}},{"generated":{"line":93,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":82,"column":16}},{"generated":{"line":94,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":83,"column":13}},{"generated":{"line":94,"column":7},"source":"Classes/VirusTotalScanner.js","original":{"line":81,"column":12}},{"name":"req","generated":{"line":95,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":85,"column":12}},{"name":"req","generated":{"line":95,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":85,"column":12}},{"generated":{"line":95,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":85,"column":15}},{"name":"write","generated":{"line":95,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":85,"column":16}},{"generated":{"line":95,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":85,"column":12}},{"name":"postData","generated":{"line":95,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":85,"column":22}},{"generated":{"line":95,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":85,"column":12}},{"name":"req","generated":{"line":96,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":86,"column":12}},{"name":"req","generated":{"line":96,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":86,"column":12}},{"generated":{"line":96,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":86,"column":15}},{"name":"end","generated":{"line":96,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":86,"column":16}},{"generated":{"line":96,"column":13},"source":"Classes/VirusTotalScanner.js","original":{"line":86,"column":12}},{"generated":{"line":97,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":87,"column":9}},{"generated":{"line":97,"column":5},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":15}},{"generated":{"line":97,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":54,"column":8}},{"generated":{"line":98,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":88,"column":5}},{"generated":{"line":100,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":4}},{"name":"_onScan","generated":{"line":100,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":10}},{"generated":{"line":100,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":4}},{"name":"task","generated":{"line":100,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":18}},{"generated":{"line":100,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":4}},{"generated":{"line":100,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":24}},{"generated":{"line":101,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":8}},{"name":"report","generated":{"line":101,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":14}},{"generated":{"line":101,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":20}},{"generated":{"line":101,"column":19},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":23}},{"generated":{"line":101,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":29}},{"name":"_getFileReport","generated":{"line":101,"column":30},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":34}},{"generated":{"line":101,"column":44},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":29}},{"name":"task","generated":{"line":101,"column":45},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":49}},{"generated":{"line":101,"column":49},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":53}},{"name":"fileHash","generated":{"line":101,"column":50},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":54}},{"generated":{"line":101,"column":58},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":29}},{"generated":{"line":101,"column":59},"source":"Classes/VirusTotalScanner.js","original":{"line":91,"column":8}},{"generated":{"line":101,"column":60},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":24}},{"generated":{"line":101,"column":61},"source":"Classes/VirusTotalScanner.js","original":{"line":93,"column":8}},{"generated":{"line":103,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":94,"column":8}},{"name":"report","generated":{"line":103,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":94,"column":12}},{"generated":{"line":103,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":94,"column":18}},{"generated":{"line":103,"column":19},"source":"Classes/VirusTotalScanner.js","original":{"line":94,"column":23}},{"generated":{"line":103,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":94,"column":8}},{"generated":{"line":103,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":94,"column":30}},{"generated":{"line":104,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":12}},{"generated":{"line":104,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":18}},{"name":"_updateFileVirustotalScanCountInDb","generated":{"line":104,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":23}},{"generated":{"line":104,"column":51},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":18}},{"name":"task","generated":{"line":104,"column":52},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":58}},{"generated":{"line":104,"column":56},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":62}},{"name":"fileName","generated":{"line":104,"column":57},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":63}},{"generated":{"line":104,"column":65},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":18}},{"name":"task","generated":{"line":104,"column":67},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":73}},{"generated":{"line":104,"column":71},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":77}},{"name":"scanNumber","generated":{"line":104,"column":72},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":78}},{"generated":{"line":104,"column":82},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":18}},{"generated":{"line":104,"column":83},"source":"Classes/VirusTotalScanner.js","original":{"line":95,"column":12}},{"generated":{"line":105,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":96,"column":12}},{"generated":{"line":106,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":97,"column":9}},{"generated":{"line":108,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":8}},{"name":"virusTotalDemands","generated":{"line":108,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":14}},{"generated":{"line":108,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":31}},{"name":"report","generated":{"line":108,"column":30},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":35}},{"generated":{"line":108,"column":36},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":41}},{"name":"positives","generated":{"line":108,"column":37},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":42}},{"generated":{"line":108,"column":46},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":35}},{"name":"parseInt","generated":{"line":108,"column":49},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":54}},{"generated":{"line":108,"column":57},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":62}},{"generated":{"line":108,"column":58},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":63}},{"name":"maximumPositives","generated":{"line":108,"column":63},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":68}},{"generated":{"line":108,"column":79},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":62}},{"generated":{"line":108,"column":80},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":35}},{"name":"report","generated":{"line":108,"column":84},"source":"Classes/VirusTotalScanner.js","original":{"line":102,"column":35}},{"generated":{"line":108,"column":90},"source":"Classes/VirusTotalScanner.js","original":{"line":102,"column":41}},{"name":"response_code","generated":{"line":108,"column":91},"source":"Classes/VirusTotalScanner.js","original":{"line":102,"column":42}},{"generated":{"line":108,"column":104},"source":"Classes/VirusTotalScanner.js","original":{"line":102,"column":35}},{"generated":{"line":108,"column":109},"source":"Classes/VirusTotalScanner.js","original":{"line":102,"column":60}},{"generated":{"line":108,"column":110},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":35}},{"generated":{"line":108,"column":111},"source":"Classes/VirusTotalScanner.js","original":{"line":102,"column":62}},{"generated":{"line":109,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":35}},{"name":"report","generated":{"line":109,"column":7},"source":"Classes/VirusTotalScanner.js","original":{"line":103,"column":35}},{"generated":{"line":109,"column":13},"source":"Classes/VirusTotalScanner.js","original":{"line":103,"column":41}},{"name":"length","generated":{"line":109,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":103,"column":42}},{"generated":{"line":109,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":103,"column":35}},{"generated":{"line":109,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":103,"column":53}},{"generated":{"line":109,"column":26},"source":"Classes/VirusTotalScanner.js","original":{"line":101,"column":8}},{"generated":{"line":109,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":24}},{"generated":{"line":109,"column":28},"source":"Classes/VirusTotalScanner.js","original":{"line":103,"column":62}},{"generated":{"line":110,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":105,"column":8}},{"generated":{"line":112,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":106,"column":8}},{"name":"virusTotalDemands","generated":{"line":112,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":106,"column":12}},{"generated":{"line":112,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":106,"column":8}},{"generated":{"line":112,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":106,"column":31}},{"generated":{"line":113,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":12}},{"generated":{"line":113,"column":12},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":18}},{"name":"_updateFileVirustotalScanCountInDb","generated":{"line":113,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":23}},{"generated":{"line":113,"column":51},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":18}},{"name":"task","generated":{"line":113,"column":52},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":58}},{"generated":{"line":113,"column":56},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":62}},{"name":"fileName","generated":{"line":113,"column":57},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":63}},{"generated":{"line":113,"column":65},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":18}},{"name":"task","generated":{"line":113,"column":67},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":73}},{"generated":{"line":113,"column":71},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":77}},{"name":"scanNumber","generated":{"line":113,"column":72},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":78}},{"generated":{"line":113,"column":82},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":18}},{"generated":{"line":113,"column":83},"source":"Classes/VirusTotalScanner.js","original":{"line":107,"column":12}},{"generated":{"line":114,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":108,"column":12}},{"generated":{"line":115,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":109,"column":9}},{"generated":{"line":115,"column":5},"source":"Classes/VirusTotalScanner.js","original":{"line":90,"column":24}},{"generated":{"line":115,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":111,"column":8}},{"generated":{"line":118,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":8}},{"name":"fileGotDeleted","generated":{"line":118,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":14}},{"generated":{"line":118,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":28}},{"generated":{"line":118,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":31}},{"generated":{"line":118,"column":33},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":37}},{"generated":{"line":118,"column":59},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":49}},{"name":"task","generated":{"line":118,"column":60},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":50}},{"generated":{"line":118,"column":64},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":54}},{"name":"fileName","generated":{"line":118,"column":65},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":55}},{"generated":{"line":118,"column":73},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":49}},{"generated":{"line":118,"column":74},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":37}},{"generated":{"line":118,"column":76},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":66}},{"generated":{"line":118,"column":88},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":37}},{"generated":{"line":118,"column":89},"source":"Classes/VirusTotalScanner.js","original":{"line":112,"column":8}},{"generated":{"line":119,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":114,"column":8}},{"name":"fileGotDeleted","generated":{"line":119,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":114,"column":12}},{"generated":{"line":119,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":114,"column":8}},{"generated":{"line":119,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":12}},{"generated":{"line":119,"column":30},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":18}},{"name":"task","generated":{"line":119,"column":62},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":36}},{"generated":{"line":119,"column":66},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":40}},{"name":"fileName","generated":{"line":119,"column":67},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":41}},{"generated":{"line":119,"column":75},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":18}},{"name":"task","generated":{"line":119,"column":77},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":51}},{"generated":{"line":119,"column":81},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":55}},{"name":"fileHash","generated":{"line":119,"column":82},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":56}},{"generated":{"line":119,"column":90},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":18}},{"name":"report","generated":{"line":119,"column":92},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":66}},{"generated":{"line":119,"column":98},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":72}},{"name":"permalink","generated":{"line":119,"column":99},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":73}},{"generated":{"line":119,"column":108},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":18}},{"generated":{"line":119,"column":110},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":84}},{"generated":{"line":119,"column":122},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":18}},{"generated":{"line":119,"column":123},"source":"Classes/VirusTotalScanner.js","original":{"line":115,"column":12}},{"generated":{"line":120,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":116,"column":5}},{"generated":{"line":121,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":118,"column":4}},{"generated":{"line":128,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":4}},{"name":"_updateFileVirustotalScanCountInDb","generated":{"line":128,"column":8},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":10}},{"generated":{"line":128,"column":42},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":4}},{"name":"fileName","generated":{"line":128,"column":43},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":45}},{"generated":{"line":128,"column":51},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":4}},{"name":"scanNumber","generated":{"line":128,"column":53},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":55}},{"generated":{"line":128,"column":63},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":4}},{"generated":{"line":128,"column":65},"source":"Classes/VirusTotalScanner.js","original":{"line":123,"column":67}},{"generated":{"line":129,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":8}},{"name":"client","generated":{"line":129,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":14}},{"generated":{"line":129,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":20}},{"generated":{"line":129,"column":19},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":23}},{"name":"db","generated":{"line":129,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":29}},{"name":"connect","generated":{"line":129,"column":43},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":32}},{"generated":{"line":129,"column":50},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":29}},{"generated":{"line":129,"column":52},"source":"Classes/VirusTotalScanner.js","original":{"line":124,"column":8}},{"generated":{"line":130,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":23}},{"name":"client","generated":{"line":130,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":29}},{"generated":{"line":130,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":35}},{"name":"query","generated":{"line":130,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":36}},{"generated":{"line":130,"column":22},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":29}},{"generated":{"line":130,"column":23},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":43}},{"generated":{"line":130,"column":88},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":29}},{"generated":{"line":130,"column":90},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":109}},{"name":"scanNumber","generated":{"line":130,"column":91},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":110}},{"generated":{"line":130,"column":101},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":109}},{"name":"fileName","generated":{"line":130,"column":103},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":122}},{"generated":{"line":130,"column":111},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":109}},{"generated":{"line":130,"column":112},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":29}},{"generated":{"line":130,"column":113},"source":"Classes/VirusTotalScanner.js","original":{"line":125,"column":23}},{"generated":{"line":131,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":126,"column":23}},{"name":"client","generated":{"line":131,"column":10},"source":"Classes/VirusTotalScanner.js","original":{"line":126,"column":29}},{"generated":{"line":131,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":126,"column":35}},{"name":"release","generated":{"line":131,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":126,"column":36}},{"generated":{"line":131,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":126,"column":29}},{"generated":{"line":131,"column":26},"source":"Classes/VirusTotalScanner.js","original":{"line":126,"column":23}},{"generated":{"line":132,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":127,"column":5}},{"generated":{"line":133,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":129,"column":4}},{"name":"scan","generated":{"line":141,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":4}},{"name":"scan","generated":{"line":141,"column":2},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":4}},{"generated":{"line":141,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":8}},{"name":"filehash","generated":{"line":141,"column":7},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":9}},{"generated":{"line":141,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":8}},{"name":"filename","generated":{"line":141,"column":17},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":19}},{"generated":{"line":141,"column":25},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":8}},{"name":"scanNumber","generated":{"line":141,"column":27},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":29}},{"generated":{"line":141,"column":37},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":8}},{"generated":{"line":141,"column":39},"source":"Classes/VirusTotalScanner.js","original":{"line":135,"column":41}},{"generated":{"line":142,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":8}},{"name":"queue","generated":{"line":142,"column":9},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":13}},{"generated":{"line":142,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":8}},{"name":"push","generated":{"line":142,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":19}},{"generated":{"line":142,"column":19},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":8}},{"generated":{"line":142,"column":20},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":24}},{"name":"fileHash","generated":{"line":143,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":137,"column":12}},{"name":"fileHash","generated":{"line":143,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":137,"column":12}},{"generated":{"line":143,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":137,"column":20}},{"name":"filehash","generated":{"line":143,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":137,"column":22}},{"generated":{"line":143,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":24}},{"name":"fileName","generated":{"line":144,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":138,"column":12}},{"name":"fileName","generated":{"line":144,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":138,"column":12}},{"generated":{"line":144,"column":14},"source":"Classes/VirusTotalScanner.js","original":{"line":138,"column":20}},{"name":"filename","generated":{"line":144,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":138,"column":22}},{"generated":{"line":144,"column":24},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":24}},{"name":"scanNumber","generated":{"line":145,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":139,"column":12}},{"name":"scanNumber","generated":{"line":145,"column":6},"source":"Classes/VirusTotalScanner.js","original":{"line":139,"column":12}},{"generated":{"line":145,"column":16},"source":"Classes/VirusTotalScanner.js","original":{"line":139,"column":22}},{"name":"scanNumber","generated":{"line":145,"column":18},"source":"Classes/VirusTotalScanner.js","original":{"line":139,"column":24}},{"generated":{"line":146,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":24}},{"generated":{"line":146,"column":5},"source":"Classes/VirusTotalScanner.js","original":{"line":136,"column":8}},{"generated":{"line":147,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":141,"column":5}},{"generated":{"line":149,"column":0},"source":"Classes/VirusTotalScanner.js","original":{"line":13,"column":24}},{"name":"VirusTotalScanner","generated":{"line":151,"column":15},"source":"Classes/VirusTotalScanner.js","original":{"line":144,"column":15}}],"sources":{"Classes/VirusTotalScanner.js":"import https         from \"https\";\r\nimport queryString   from \"querystring\";\r\nimport async         from \"async\";\r\nimport { promisify } from \"util\";\r\nimport fs            from \"fs\";\r\nimport sleep         from \"../Functions/sleep\";\r\nimport db            from \"../helpers/database\";\r\nimport deleteFiles   from \"../Functions/FileDeletion/deleteFiles\";\r\nimport logToTransparency from \"../Functions/Transparency/logToTransparency\";\r\n\r\nconst unlink   = promisify(fs.unlink);\r\n\r\nclass VirusTotalScanner {\r\n    /**\r\n     * \r\n     * @param {String} APIKey \r\n     * @param {Number} waitTime \r\n     * @param {Number} scansPrMinute \r\n     * @param {Number} maximumPositives \r\n     * @param {String} uploadDir \r\n     */\r\n    constructor(APIKey, waitTime, scansPrMinute, maximumPositives, uploadDir) {\r\n        this.APIKey           = APIKey;\r\n        this.uploadDir        = uploadDir;\r\n        this.waitTime         = parseInt(waitTime);\r\n        this.scansPrMinute    = parseInt(scansPrMinute);\r\n        this.maximumPositives = parseInt(maximumPositives);\r\n        this.amountOfScans    = 0;\r\n\r\n        this.options = {\r\n            hostname: \"virustotal.com\",\r\n            port: \"443\",\r\n            path: \"/vtapi/v2/file/report\",\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Accept-Encoding\": \"gzip deflate\",\r\n                \"User-Agent\": \"gzip \" + process.env.VIRUSTOTAL_USER\r\n            }\r\n        }\r\n\r\n        this.queue = async.queue(async task => {\r\n            // This is how the scanner i limited to 4 scans pr minute\r\n            if (this.amountOfScans == this.scansPrMinute) {\r\n                await sleep(this.waitTime);\r\n                this.amountOfScans = 0;\r\n            }\r\n            this.amountOfScans++;\r\n\r\n            await this._onScan(task);\r\n        }, 1);\r\n    }\r\n\r\n    _getFileReport(fileHash) {\r\n        return new Promise((resolve, reject) => {\r\n            const postData = queryString.stringify({\r\n                \"resource\": fileHash,\r\n                \"apikey\": this.APIKey\r\n            });\r\n        \r\n            const req = https.request(this.options, res => {\r\n                let end = \"\";\r\n                res.on(\"data\", d => {\r\n                    end += d;\r\n                });\r\n    \r\n                res.on(\"end\", () => {\r\n                    // If for whatever reason VirusTotal doesn't approve of your request it will give you empty string\r\n                    // JSON.parse doesn't like empty string\r\n                    //...\r\n                    const result = end.length === 0 ? null \r\n                                                    : JSON.parse(end);\r\n    \r\n                    resolve(result);\r\n                });\r\n    \r\n                res.on(\"error\", e => {\r\n                    reject(e);\r\n                });\r\n            });\r\n        \r\n            req.on(\"error\", e => {\r\n                reject(e);\r\n            })\r\n            \r\n            req.write(postData);\r\n            req.end();\r\n        });\r\n    } \r\n\r\n    async _onScan(task) {\r\n        const report = await this._getFileReport(task.fileHash);\r\n\r\n        // Should I wait and try again?\r\n        if (report === null)  {\r\n            await this._updateFileVirustotalScanCountInDb(task.fileName, task.scanNumber);\r\n            return;\r\n        }\r\n        \r\n\r\n\r\n        const virusTotalDemands =  report.positives < parseInt(this.maximumPositives)\r\n                                || report.response_code === 0 // The file is not in the database\r\n                                || report.length === 0;       // ^\r\n\r\n        // If there are too few positives\r\n        if (virusTotalDemands) {\r\n            await this._updateFileVirustotalScanCountInDb(task.fileName, task.scanNumber);\r\n            return;\r\n        }\r\n\r\n        // Remove the file if there are too many positives\r\n        const fileGotDeleted = await deleteFiles([task.fileName], \"VirusTotal\");\r\n\r\n        if (fileGotDeleted)\r\n            await logToTransparency(task.fileName, task.fileHash, report.permalink, \"Virustotal\");\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {*} fileName \r\n     * @param {*} scanNumber \r\n     */\r\n    async _updateFileVirustotalScanCountInDb(fileName, scanNumber) {\r\n        const client = await db.connect();\r\n                       await client.query(`UPDATE \"Uploads\" SET \"virustotalScan\" = $1 WHERE filename = $2;`, [scanNumber, fileName]);\r\n                       await client.release();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {String} filehash - The files hash \r\n     * @param {String} filename - The name of the file on disk\r\n     * @param {Number} scanNumber - The scan that has been performed\r\n     */\r\n    scan(filehash, filename, scanNumber) {\r\n        this.queue.push({\r\n            fileHash: filehash,\r\n            fileName: filename,\r\n            scanNumber: scanNumber\r\n        })\r\n    }\r\n}\r\n\r\nexport default VirusTotalScanner;"},"lineCount":null}},"hash":"e5c7cfdb47f27e9ac4718d5818475221","cacheData":{"env":{}}}